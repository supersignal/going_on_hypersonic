# Nicepay API 2.0 - μΉ΄λ“ λΉλ§ API
- https://developers.nicepay.co.kr/manual-card-billing.php

## 1. κ°μ”  
- **μΉ΄λ“ λΉλ§(μλ™κ²°μ )** μ„λΉ„μ¤λ” κ³ κ°μ΄ κ²°μ  μλ‹¨μ„ λ“±λ΅ν•λ©΄, μ΄ν›„ λ³„λ„ μ…λ ¥ μ—†μ΄ μλ™μΌλ΅ κ²°μ κ°€ κ°€λ¥ν• λ°©μ‹μ…λ‹λ‹¤.  
- μµμ΄ μΉ΄λ“μ •λ³΄λ” **κ°€λ§Ήμ μ΄ μ…λ ¥**ν•λ©°, NICEPAYλ” μ΄λ¥Ό **μ•”νΈν™” μ²λ¦¬ ν›„ λΉλ§ ν‚¤(Billing Key)**λ¥Ό λ°κΈ‰ν•©λ‹λ‹¤.  
- νμ΄μ§€μ—μ„λ” μΉ΄λ“μ •λ³΄ μ•”νΈν™” μ μ°¨ λ° λΉλ§ ν‚¤ λ°κΈ‰ ν”„λ΅μ„Έμ¤μ— λ€ν•΄ μ†κ°ν•κ³  μμµλ‹λ‹¤.

---

## 2. μΉ΄λ“ λΉλ§ κµ¬μ΅° λ° κΈ°λ³Έ νλ¦„  
1. κ³ κ°μ μΉ΄λ“ μ •λ³΄λ¥Ό μμ§‘ν•κ³ , λΈλΌμ°μ €λ‚ μ„λ²„μ—μ„ **AES λ°©μ‹μΌλ΅ μ•”νΈν™”**  
2. μ•”νΈν™”λ λ°μ΄ν„°λ¥Ό NICEPAYμ— μ „μ†΅ν•μ—¬ **λΉλ§ ν‚¤ λ°κΈ‰ μ”μ²­**  
3. NICEPAYκ°€ Billing Keyλ¥Ό λ°κΈ‰ν•κ³ , μ΄ν›„ μ΄λ¥Ό μ΄μ©ν•΄ **μλ™ κ²°μ  μν–‰ κ°€λ¥**

---

## 3. μ”μ²­(Request) λ…μ„Έ 
- **URL**: `https://webapi.nicepay.co.kr/webapi/billing/billing_regist.jsp`
- **HTTP λ©”μ„λ“**: POST
- **Content-Type**: `application/x-www-form-urlencoded` λλ” `application/json`
- μ”μ²­ μ‹ ν•„μ ν¬ν•¨ ν•­λ©:
  - κ³ κ° μΉ΄λ“μ •λ³΄(μ•”νΈν™” ν¬ν•¨)
  - κ°€λ§Ήμ  μ •λ³΄(MID, Moid, EdiDate λ“±)
  - SignData λ“± μ„λ³€μ΅° κ²€μ¦κ°’

| νλΌλ―Έν„°λ…      | κΈΈμ΄  | ν•„μ | μ„¤λ… |
|---------------|------|------|------|
| MID           | 10B  | Y  | κ°€λ§Ήμ  ID |
| EdiDate       | 14B  | Y  | μ „λ¬Έμƒμ„±μΌμ‹ (YYYYMMDDHHMMSS) |
| Moid          | 64B  | Y  | κ°€λ§Ήμ μ—μ„ λ¶€μ—¬ν• μ£Όλ¬Έλ²νΈ (Uniqueν•κ² κµ¬μ„±) |
| EncData       | 512B  | Y  | κ²°μ  μ •λ³΄ μ•”νΈν™” λ°μ΄ν„° `Hex(AES(CardNo=value&ExpYear=YY&ExpMonth=MM&IDNo=value&CardPw=value))` |
| SignData      | 256B  | Y  | `hex(sha256(MID + EdiDate + Moid + MerchantKey))`, μ„λ³€μ΅° κ²€μ¦ λ°μ΄ν„° |
| BuyerEmail    | 60B  |  | λ©”μΌμ£Όμ† |
| BuyerTel      | 20B  |  | κµ¬λ§¤μ μ—°λ½μ² |
| BuyerName     | 30B  |  | κµ¬λ§¤μλ… |
| CharSet       | 10B  |  | μΈμ¦ μ‘λ‹µ μΈμ½”λ”© (euc-kr(default) / utf-8) |
| EdiType       | 10B  |  | μ‘λ‹µμ „λ¬Έ μ ν• (JSON / KV) *KV:Key=value |
 
---

## 4. EncData(μ•”νΈν™” λ°μ΄ν„°) μ²λ¦¬ λ°©μ‹  
- μΉ΄λ“λ²νΈ, μ ν¨κΈ°κ°„, μΉ΄λ“ λΉ„λ°€λ²νΈ λ“±μ„ AESβ€‘128 λ°©μ‹μΌλ΅ μ•”νΈν™”  
- **ECB λ¨λ“ + PKCS5Padding**, κ²°κ³Όλ” Hex λ¬Έμμ—΄λ΅ λ³€ν™  
- MerchantKeyλ¥Ό κΈ°λ°μΌλ΅ μ•”νΈν™” ν‚¤ μƒμ„±

| νλΌλ―Έν„°λ…    | κΈΈμ΄ | ν•„μ | μ„¤λ… |
|-------------|------|------|------|
| CardNo      | 16B  | Y  | μΉ΄λ“λ²νΈ |
| ExpYear     | 2B   | Y  | μΉ΄λ“ μ ν¨κΈ°κ°„(λ…„) (YY) |
| ExpMonth    | 2B   | Y  | μΉ΄λ“ μ ν¨κΈ°κ°„(μ›”) (MM) |
| IDNo        | 13B  |  | κ³„μ•½ ν„ν™©μ— λ”°λΌ μ „λ‹¬ ν•„μ”(μμ—…λ‹΄λ‹Ήμ ν‘μ) μƒλ…„μ›”μΌ(6μλ¦¬, YYMMDD) λλ” μ‚¬μ—…μλ²νΈ(10μλ¦¬) |
| CardPw      | 2B   |  | κ³„μ•½ ν„ν™©μ— λ”°λΌ μ „λ‹¬ ν•„μ”(μμ—…λ‹΄λ‹Ήμ ν‘μ) μΉ΄λ“ λΉ„λ°€λ²νΈ μ• 2μλ¦¬ |

---

## 5. μ‘λ‹µ(Response) ν•­λ©  
- μ„±κ³µ μ‹ NICEPAYλ” **Billing Key**, **ResultCode**, **ResultMsg** λ“±μ„ μ‘λ‹µ  
- μ΄ν›„ κ³ κ°μ΄ λΉλ§ κ²°μ λ¥Ό μ”μ²­ν•λ©΄, Billing Keyλ¥Ό μ‚¬μ©ν•΄ μλ™ κ²°μ  μν–‰ κ°€λ¥

| νλΌλ―Έν„°λ…       | κΈΈμ΄ | ν•„μ | μ„¤λ… |
|----------------|------|------|------|
| ResultCode     | 4B   | Y   |κ²°κ³Ό μ½”λ“ (F100: μ„±κ³µ / κ·Έμ™Έ μ‹¤ν¨) |
| ResultMsg      | 100B | Y   |κ²°κ³Ό λ©”μ‹μ§€ |
| TID            | 30B  | Y   |κ±°λ ID |
| BID            | 30B  |  |λΉν‚¤, κ°€λ§Ήμ μ—μ„ κ΄€λ¦¬ν•μ—¬ μΉμΈ μ”μ²­ μ‹ μ „λ‹¬ |
| AuthDate       | 8B   |  |λΉν‚¤ λ°κΈ‰μΌμ(YYYYMMDD) |
| CardCode       | 4B   |  |μΉ΄λ“μ‚¬ μ½”λ“ |
| CardName       | 20B  |  |μΉ΄λ“μ‚¬λ… |
| CardCl         | 1B   |  |μΉ΄λ“νƒ€μ… (0: μ‹ μ©μΉ΄λ“, 1: μ²΄ν¬μΉ΄λ“) |
| AcquCardCode   | 4B   |  |λ§¤μ… μΉ΄λ“μ‚¬ μ½”λ“ |
| AcquCardName   | 20B  |  |λ§¤μ… μΉ΄λ“μ‚¬λ… |

---

## 6. μ¤‘μ” κ³ λ ¤μ‚¬ν•­  
- **κ³ κ° μΉ΄λ“μ •λ³΄ μ§μ ‘ μ…λ ¥ κΈμ§€** κ¶κ³ : κ°€λ§Ήμ  μ„λ²„ λλ” NICEPAY μ„νƒ μ €μ¥ λ°©μ‹ μ‚¬μ© κ¶μ¥ 
- μ—°λ™ μ‹ μƒλ“λ°•μ¤μ™€ μ΄μ ν™κ²½ λ„λ©”μΈ/ν‚¤ μ„¤μ • ν™•μΈ ν•„μ  
- λΉλ§ ν‚¤ μ €μ¥ λ° μ¬μ‚¬μ© μ‹ λ³΄μ•/κ°μΈμ •λ³΄ λ³΄νΈ κ³ λ ¤

---

## 7. λΉν‚¤ λ°κΈ‰ μƒν”μ½”λ“
### 1. Java/JSP κµ¬ν„

```jsp
<%@ page contentType="text/html; charset=euc-kr"%>
<%@ page import="java.util.Date" %>
<%@ page import="java.util.HashMap" %>
<%@ page import="java.util.Iterator" %>
<%@ page import="java.io.PrintWriter" %>
<%@ page import="java.io.BufferedReader" %>
<%@ page import="java.io.InputStreamReader" %>
<%@ page import="java.net.URL" %>
<%@ page import="java.net.URLEncoder" %>
<%@ page import="java.net.HttpURLConnection" %>
<%@ page import="java.text.SimpleDateFormat" %>
<%@ page import="java.security.MessageDigest" %>
<%@ page import="java.util.StringTokenizer" %>
<%@ page import="javax.crypto.Cipher" %>
<%@ page import="javax.crypto.spec.SecretKeySpec" %>
<%@ page import="org.json.simple.JSONObject" %>
<%@ page import="org.json.simple.parser.JSONParser" %>
<%@ page import="org.apache.commons.codec.binary.Hex" %>
<%
request.setCharacterEncoding("euc-kr"); 

/*
****************************************************************************************
* <μ”μ²­ κ°’ μ •λ³΄>
* μ•„λ νλΌλ―Έν„°μ— μ”μ²­ν•  κ°’μ„ μ•λ§κ² μ…λ ¥ν•©λ‹λ‹¤.
****************************************************************************************
*/
String MID 			= "nictest04m";	// μƒμ  ID
String Moid			= "";	// μ£Όλ¬Έλ²νΈ

String CardNo 		= "";	// μΉ΄λ“λ²νΈ
String ExpYear 		= "";	// μ ν¨κΈ°κ°„(λ…„)
String ExpMonth 	= "";	// μ ν¨κΈ°κ°„(μ›”)
String IDNo 		= "";	// μƒλ…„μ›”μΌ/μ‚¬μ—…μλ²νΈ
String CardPw 		= "";	// μΉ΄λ“λΉ„λ°€λ²νΈ

//κ²°κ³Ό μ½”λ“μ™€ λ©”μ„Έμ§€λ¥Ό μ €μ¥ν•  λ³€μλ¥Ό λ―Έλ¦¬ μ„ μ–Έν•©λ‹λ‹¤.
String ResultCode 	= "";
String ResultMsg 	= "";

/*
*******************************************************
* <ν•΄μ‰¬μ•”νΈν™”> (μμ •ν•μ§€ λ§μ„Έμ”)
* SHA-256 ν•΄μ‰¬μ•”νΈν™”λ” κ±°λ μ„λ³€μ΅°λ¥Ό λ§‰κΈ°μ„ν• λ°©λ²•μ…λ‹λ‹¤. 
*******************************************************
*/
DataEncrypt sha256Enc 	= new DataEncrypt();
String ediDate 			= getyyyyMMddHHmmss();
String SignData 		= sha256Enc.encrypt(MID + ediDate + Moid + merchantKey);

/*
*******************************************************
* <AESμ•”νΈν™”> (μμ •ν•μ§€ λ§μ„Έμ”)
* AES μ•”νΈν™”λ” κ²°μ  μΉ΄λ“μ •λ³΄λ¥Ό μ•”νΈν™” ν•κΈ° μ„ν• λ°©λ²•μ…λ‹λ‹¤.
* Key=Value ν•νƒμ Plain-Textλ΅ μΉ΄λ“μ •λ³΄λ¥Ό λ‚μ—΄ν•©λ‹λ‹¤.
* IDNoμ™€ CardPwλ” MIDμ— μ„¤μ •λ μΈμ¦λ°©μ‹μ— λ”°λΌ ν•„μ μ—¬λ¶€κ°€ κ²°μ •λ©λ‹λ‹¤. 
*******************************************************
*/
StringBuffer EncDataBuf = new StringBuffer();
EncDataBuf.append("CardNo=").append(CardNo).append("&");
EncDataBuf.append("ExpYear=").append(ExpYear).append("&");
EncDataBuf.append("ExpMonth=").append(ExpMonth).append("&");
EncDataBuf.append("IDNo=").append(IDNo).append("&");
EncDataBuf.append("CardPw=").append(CardPw);
String EncData = encryptAES(EncDataBuf.toString(), merchantKey.substring(0,16));

/*
****************************************************************************************
* <λΉν‚¤ λ°κΈ‰ μ”μ²­>
* λΉν‚¤ λ°κΈ‰μ— ν•„μ”ν• λ°μ΄ν„° μƒμ„± ν›„ server to server ν†µμ‹ μ„ ν†µν•΄ μΉμΈ μ²λ¦¬ ν•©λ‹λ‹¤.
* λ…μ„Έμ„λ¥Ό μ°Έκ³ ν•μ—¬ ν•„μ”μ— λ”°λΌ νλΌλ―Έν„°μ™€ κ°’μ„ Key=Value ν•νƒλ΅ μ¶”κ°€ν•΄μ£Όμ„Έμ”.
****************************************************************************************
*/
StringBuffer requestData = new StringBuffer();
requestData.append("MID=").append(MID).append("&");
requestData.append("EdiDate=").append(ediDate).append("&");
requestData.append("Moid=").append(Moid).append("&");
requestData.append("EncData=").append(EncData).append("&");
requestData.append("SignData=").append(SignData);
	
//API νΈμ¶, κ²°κ³Ό λ°μ΄ν„°κ°€ resultJsonStr λ³€μμ— μ €μ¥λ©λ‹λ‹¤.
String resultJsonStr = connectToServer(requestData.toString(), "https://webapi.nicepay.co.kr/webapi/billing/billing_regist.jsp");

//κ²°κ³Ό λ°μ΄ν„°λ¥Ό HashMap ν•νƒλ΅ λ³€ν™ν•©λ‹λ‹¤. 
HashMap resultData = new HashMap();
resultData = jsonStringToHashMap(resultJsonStr);

ResultCode 	= (String)resultData.get("ResultCode");
ResultMsg 	= (String)resultData.get("ResultMsg");

%>
<!DOCTYPE html>
<html>
<head>
<title>NICEPAY BILLING REGIST REQUEST(EUC-KR) SAMPLE</title>
<meta charset="euc-kr">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes, target-densitydpi=medium-dpi" />
<link rel="stylesheet" type="text/css" href="../css/import.css"/>
</head>
<body> 
<div class="payfin_area">
	<div class="top">λΉν‚¤ λ°κΈ‰ κ²°κ³Ό</div>
	<div class="conwrap">
		<div class="con">
			<div class="tabletypea">
				<table>
					<colgroup><col width="200px"/><col width="*"/></colgroup>
					<tr>
						<th><span>λΉν‚¤λ°κΈ‰ κ²°κ³Ό λ‚΄μ©</span></th>
						<td>[<%=ResultCode%>]<%=ResultMsg%></td>
					</tr>
					<tr>
						<th><span>λΉν‚¤λ°κΈ‰ μ‘λ‹µ λ°μ΄ν„°</span></th>
						<td><%=resultJsonStr%></td>
					</tr>
				</table>
			</div>
		</div>
		<p>*ν…μ¤νΈ μ•„μ΄λ””μΈκ²½μ° λ‹ΉμΌ μ¤ν›„ 11μ‹ 30λ¶„μ— μ·¨μ†λ©λ‹λ‹¤.</p>
	</div>
</div>
</body>
</html>
<%!
//μ¤‘μ”!. κ°€λ§Ήμ  MIDμ— λ§λ” keyκ°’μ„ μ„¤μ •ν•μ„Έμ”.
static final String merchantKey = "b+zhZ4yOZ7FsH8pm5lhDfHZEb79tIwnjsdA0FBXh86yLc6BJeFVrZFXhAoJ3gEWgrWwN+lJMV0W4hvDdbe4Sjw=="; //nictest04mμ μƒμ ν‚¤

//yyyyMMddHHmmss ν•μ‹ date μƒμ„± ν•¨μ
public final synchronized String getyyyyMMddHHmmss(){
	SimpleDateFormat yyyyMMddHHmmss = new SimpleDateFormat("yyyyMMddHHmmss");
	return yyyyMMddHHmmss.format(new Date());
}

// SHA-256 ν•μ‹μΌλ΅ μ•”νΈν™”
public class DataEncrypt{
	MessageDigest md;
	String strSRCData = "";
	String strENCData = "";
	String strOUTData = "";
	
	public DataEncrypt(){ }
	public String encrypt(String strData){
		String passACL = null;
		MessageDigest md = null;
		try{
			md = MessageDigest.getInstance("SHA-256");
			md.reset();
			md.update(strData.getBytes());
			byte[] raw = md.digest();
			passACL = encodeHex(raw);
		}catch(Exception e){
			System.out.print("μ•”νΈν™” μ—λ¬" + e.toString());
		}
		return passACL;
	}
	
	public String encodeHex(byte [] b){
		char [] c = Hex.encodeHex(b);
		return new String(c);
	}
}

/**
 * λ€μ™Έ ν†µμ‹  μƒν”.
 *  μ™Έλ¶€ κΈ°κ΄€κ³Ό URL ν†µμ‹ ν•λ” μƒν” ν•¨μ μ…λ‹λ‹¤.
 *  μƒν”μ†μ¤λ” μ„λΉ„μ¤ μ•μ •μ„±μ„ λ³΄μ¥ν•μ§€ μ•μΌλ―€λ΅, κ°€λ§Ήμ  ν™κ²½μ— λ§κ² κµ¬ν„ λ°”λλ‹λ‹¤.
 *  μƒν”μ†μ¤ μ΄μ©μ— λ”°λ¥Έ μ΄μ λ°μƒμ‹ NICEPAYμ—μ„ μ±…μ„μ§€μ§€ μ•μµλ‹λ‹¤. 
*/
public static String connectToServer(String data, String reqUrl) throws Exception{
	HttpURLConnection conn 		= null;
	BufferedReader resultReader = null;
	PrintWriter pw 				= null;
	URL url 					= null;
	
	int statusCode = 0;
	StringBuffer recvBuffer = new StringBuffer();
	try{
		url = new URL(reqUrl);
		conn = (HttpURLConnection) url.openConnection();
		conn.setRequestMethod("POST");
		conn.setConnectTimeout(15000);
		conn.setReadTimeout(25000);
		conn.setDoOutput(true);
		
		pw = new PrintWriter(conn.getOutputStream());
		pw.write(data);
		pw.flush();
		
		statusCode = conn.getResponseCode();
		resultReader = new BufferedReader(new InputStreamReader(conn.getInputStream(), "euc-kr"));
		for(String temp; (temp = resultReader.readLine()) != null;){
			recvBuffer.append(temp).append("\n");
		}
		
		if(!(statusCode == HttpURLConnection.HTTP_OK)){
			throw new Exception("ERROR");
		}
		
		return recvBuffer.toString().trim();
	}catch (Exception e){
		return "ERROR";
	}finally{
		recvBuffer.setLength(0);
		
		try{
			if(resultReader != null){
				resultReader.close();
			}
		}catch(Exception ex){
			resultReader = null;
		}
		
		try{
			if(pw != null) {
				pw.close();
			}
		}catch(Exception ex){
			pw = null;
		}
		
		try{
			if(conn != null) {
				conn.disconnect();
			}
		}catch(Exception ex){
			conn = null;
		}
	}
}

//jsonν•νƒμ Stringμ„ HashMapμΌλ΅ λ³€ν™ν•΄μ£Όλ” ν•¨μμ…λ‹λ‹¤. 
private static HashMap jsonStringToHashMap(String str) throws Exception{
	HashMap dataMap = new HashMap();
	JSONParser parser = new JSONParser();
	try{
		Object obj = parser.parse(str);
		JSONObject jsonObject = (JSONObject)obj;

		Iterator<String> keyStr = jsonObject.keySet().iterator();
		while(keyStr.hasNext()){
			String key = keyStr.next();
			Object value = jsonObject.get(key);
			
			dataMap.put(key, value);
		}
	}catch(Exception e){
		
	}
	return dataMap;
}

//hex aes μ•”νΈν™” μƒν” (μΉ΄λ“ μ •λ³΄λ¥Ό μ•”νΈν™”ν•  λ• μ‚¬μ©ν•©λ‹λ‹¤.)
public static String encryptAES(String input, String key) {
	byte[] crypted = null;
	try {
		SecretKeySpec skey = new SecretKeySpec(key.getBytes(), "AES");

		Cipher cipher = Cipher.getInstance("AES/ECB/PKCS5Padding");
		cipher.init(Cipher.ENCRYPT_MODE, skey);
		crypted = cipher.doFinal(input.getBytes());
		
		StringBuffer sb = new StringBuffer();
		for (int i = 0; i < crypted.length; i++) {
			String hex = Integer.toHexString(crypted[i] & 0xFF);
			if (hex.length() == 1) {
				hex = '0' + hex;
			}
			sb.append(hex.toUpperCase());
		}
		return sb.toString(); 
	} catch (Exception e) {
		e.printStackTrace();
	}
	return null;
}
%>
```

### 2. PHP κµ¬ν„

```php
<?php
header("Content-Type:text/html; charset=euc-kr;"); 

// λΉν‚¤ λ°κΈ‰(λΉ„μΈμ¦) API μ”μ²­ URL
$postURL = "https://webapi.nicepay.co.kr/webapi/billing/billing_regist.jsp";

/*
****************************************************************************************
* <μ”μ²­ κ°’ μ •λ³΄>
* μ•„λ νλΌλ―Έν„°μ— μ”μ²­ν•  κ°’μ„ μ•λ§κ² μ…λ ¥ν•©λ‹λ‹¤. 
****************************************************************************************
*/
$mid 		= "nictest04m";		// κ°€λ§Ήμ  μ•„μ΄λ”” 
$moid 		= "";				// κ°€λ§Ήμ  μ£Όλ¬Έλ²νΈ
$buyerName 	= "";				// κµ¬λ§¤μλ…
$buyerTel 	= "";				// κµ¬λ§¤μ μ „ν™”λ²νΈ
$buyerEmail = "";				// κµ¬λ§¤μ μ΄λ©”μΌ
$cardNo 	= "";				// μΉ΄λ“λ²νΈ
$expYear 	= "";				// μ ν¨κΈ°κ°„(λ…„) 
$expMonth 	= "";				// μ ν¨κΈ°κ°„(μ›”) 
$idNo		= "";				// μ£Όλ―Όλ²νΈ λλ” μ‚¬μ—…μλ²νΈ
$cardPw 	= "";				// μΉ΄λ“ λΉ„λ°€λ²νΈ μ• 2μλ¦¬

// Key=Value ν•νƒμ Plain-Textλ΅ μΉ΄λ“μ •λ³΄λ¥Ό λ‚μ—΄ν•©λ‹λ‹¤.
// IDNoμ™€ CardPwλ” MIDμ— μ„¤μ •λ μΈμ¦λ°©μ‹μ— λ”°λΌ ν•„μ μ—¬λ¶€κ°€ κ²°μ •λ©λ‹λ‹¤. 
$plainText = "CardNo=".$cardNo."&ExpYear=".$expYear."&ExpMonth=".$expMonth."&IDNo=".$idNo."&CardPw=".$cardPw;	// μΉ΄λ“μ •λ³΄ κµ¬μ„± (key=value&key=value&...)
		
// κ²°κ³Ό λ°μ΄ν„°λ¥Ό μ €μ¥ν•  λ³€μλ¥Ό λ―Έλ¦¬ μ„ μ–Έν•©λ‹λ‹¤. 
$response = "";	

/*
****************************************************************************************
* <μ„λ³€μ΅° κ²€μ¦κ°’ λ° μΉ΄λ“ μ •λ³΄ μ•”νΈν™”> (μμ •ν•μ§€ λ§μ„Έμ”)
* SHA-256 ν•΄μ‰¬ μ•”νΈν™”λ” κ±°λ μ„λ³€μ΅°λ¥Ό λ§‰κΈ°μ„ν• λ°©λ²•μ…λ‹λ‹¤. 
****************************************************************************************
*/	
$ediDate = date("YmdHis");																						// API μ”μ²­ μ „λ¬Έ μƒμ„±μΌμ‹
$merchantKey = "b+zhZ4yOZ7FsH8pm5lhDfHZEb79tIwnjsdA0FBXh86yLc6BJeFVrZFXhAoJ3gEWgrWwN+lJMV0W4hvDdbe4Sjw==";		// κ°€λ§Ήμ  ν‚¤
$encData = bin2hex(aesEncryptSSL($plainText, substr($merchantKey, 0, 16)));										// μΉ΄λ“μ •λ³΄ μ•”νΈν™”
$signData = bin2hex(hash('sha256', $mid . $ediDate . $moid . $merchantKey, true));								// μ„λ³€μ΅° λ°μ΄ν„° κ²€μ¦ κ°’ μ•”νΈν™”


/*
****************************************************************************************
* <API μ”μ²­λ¶€>
* λ…μ„Έμ„λ¥Ό μ°Έκ³ ν•μ—¬ ν•„μ”μ— λ”°λΌ νλΌλ―Έν„°μ™€ κ°’μ„ 'key'=>'value' ν•νƒλ΅ μ¶”κ°€ν•΄μ£Όμ„Έμ”
****************************************************************************************
*/	

$data = Array(
	'MID' => $mid,
	'Moid' => $moid,
	'EdiDate' => $ediDate,
	'EncData' => $encData,
	'SignData' => $signData
);		

$response = reqPost($data, $postURL); 				//API νΈμ¶, κ²°κ³Ό λ°μ΄ν„°κ°€ $response λ³€μμ— μ €μ¥λ©λ‹λ‹¤.
jsonRespDump($response); 							//κ²°κ³Ό λ°μ΄ν„°λ¥Ό λΈλΌμ°μ €μ— λ…Έμ¶ν•©λ‹λ‹¤.
		
	

// μΉ΄λ“ μ •λ³΄λ¥Ό μ•”νΈν™”ν•  λ• μ‚¬μ©ν•λ” AES μ•”νΈν™” (opnessl) ν•¨μμ…λ‹λ‹¤. 
function aesEncryptSSL($data, $key){
	$iv = openssl_random_pseudo_bytes(16);
	$encdata = @openssl_encrypt($data, "AES-128-ECB", $key, true, $iv);
	return $encdata;
}


// jsonμΌλ΅ μ‘λ‹µλ κ²°κ³Ό λ°μ΄ν„°λ¥Ό λ°°μ—΄ ν•νƒλ΅ λ³€ν™ν•μ—¬ μ¶λ ¥ν•λ” ν•¨μμ…λ‹λ‹¤. 
// μ‘λ‹µ λ°μ΄ν„° μ¶λ ¥μ„ μ„ν• μμ‹λ΅ ν…μ¤νΈ μ΄ν›„ κ°€λ§Ήμ  μƒν™©μ— λ§κ² λ³€κ²½ν•©λ‹λ‹¤. 
function jsonRespDump($resp){
	$resp_utf = iconv("EUC-KR", "UTF-8", $resp); 
	$respArr = json_decode($resp_utf);
	foreach ( $respArr as $key => $value ){
		echo "$key=". iconv("UTF-8", "EUC-KR", $value)."<br />";
	}
}

// APIλ¥Ό POST ν•νƒλ΅ νΈμ¶ν•λ” ν•¨μμ…λ‹λ‹¤. 
function reqPost(Array $data, $url){
	$ch = curl_init();
	curl_setopt($ch, CURLOPT_URL, $url);
	curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
	curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 15);					//connection timeout 15 
	curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
	curl_setopt($ch, CURLOPT_POSTFIELDS, http_build_query($data));	//POST data
	curl_setopt($ch, CURLOPT_POST, true);
	$response = curl_exec($ch);
	curl_close($ch);	 
	return $response;
}
?> 
```

### 3. node κµ¬ν„

```nodejs
const express = require('express')
const axios = require('axios')
const app = express()
const port = 3000
const iconv = require('iconv-lite')
const bodyParser = require('body-parser')
const crypto = require('crypto')
const CryptoJS = require('crypto-js')
const format = require('date-format')
const fs = require('fs')
const ejs = require('ejs')

/*
****************************************************************************************
* κ°€λ§Ήμ κ΄€λ¦¬μ νμ΄μ§€(npg.nicepay.co.kr) λ΅κ·ΈμΈ > κ°€λ§Ήμ  μ •λ³΄ > Keyκ΄€λ¦¬
* μƒκΈ° κ²½λ΅λ¥Ό ν†µν•΄μ„ κ°€λ§Ήμ  μ•„μ΄λ””μΈ MIDμ™€ κ°€λ§Ήμ  ν‚¤ κ°’μ„ ν™•μΈν•μ—¬ 
* μ•„λ merchantID, merchantKey νλΌλ―Έν„°μ— κ°κ° μ…λ ¥ν•©λ‹λ‹¤.  
****************************************************************************************
*/
const merchantKey = 'b+zhZ4yOZ7FsH8pm5lhDfHZEb79tIwnjsdA0FBXh86yLc6BJeFVrZFXhAoJ3gEWgrWwN+lJMV0W4hvDdbe4Sjw=='; // κ°€λ§Ήμ  ν‚¤
const merchantID = 'nictest04m'; // κ°€λ§Ήμ  ID

// API μ”μ²­ μ „λ¬Έ μƒμ„± μ‹ μ‹κ°„ μ •λ³΄λ¥Ό μ €μ¥ν•©λ‹λ‹¤. 
const ediDate = format.asString('yyyyMMddhhmmss', new Date()); // API μ”μ²­ μ „λ¬Έ μƒμ„±μΌμ‹

// μ•„λ νλΌλ―Έν„°μ— μ”μ²­κ°’ μ •λ³΄λ¥Ό μ•λ§κ² μ…λ ¥ν•©λ‹λ‹¤. 
const cardNo = '';          	// μΉ΄λ“λ²νΈ
const expYear = '';	        // μ ν¨κΈ°κ°„(λ…„) 
const expMonth = '';      	// μ ν¨κΈ°κ°„(μ›”) 
const idNo = '';             	// μ£Όλ―Όλ²νΈ λλ” μ‚¬μ—…μλ²νΈ
const cardPw = '';         	// μΉ΄λ“ λΉ„λ°€λ²νΈ μ• 2μλ¦¬
const moid = '';            	// κ°€λ§Ήμ  μ£Όλ¬Έλ²νΈ

app.use(express.static('public'))
app.use(bodyParser.urlencoded({ extended: false }))


// λΉν‚¤ λ°κΈ‰ μ”μ²­
app.post('/bidCreate', async function(req, res){

    // Key=Value ν•νƒμ Plain-Textλ΅ μΉ΄λ“μ •λ³΄λ¥Ό λ‚μ—΄ν•©λ‹λ‹¤. 
    const aesString = 'CardNo=' + cardNo + '&ExpYear=' + expYear + '&ExpMonth=' + expMonth + '&IDNo=' + idNo + '&CardPw= + cardPw;
    
	// λ°μ΄ν„° μ„λ³€μ΅° κ²€μ¦κ°’μ„ μƒμ„±ν•©λ‹λ‹¤. (κ±°λ μ„λ³€μ΅°λ¥Ό λ§‰κΈ° μ„ν• λ°©λ²•μ…λ‹λ‹¤. μμ •μ„ κΈμ§€ν•©λ‹λ‹¤.)
	const signData = getSignData(merchantID + ediDate + moid + merchantKey).toString();
	
	// λΉν‚¤ λ°κΈ‰ API μ”μ²­ ν›„ μ‘λ‹µμ„ λ°›μ•„ consoleκ³Ό λΈλΌμ°μ €μ— μ¶λ ¥ν•©λ‹λ‹¤. 
    const response = await axios({
        url: 'https://webapi.nicepay.co.kr/webapi/billing/billing_regist.jsp',
        method: 'POST',
        headers: {
            'User-Agent': 'Super Agent/0.0.1',
            'Content-Type': 'application/x-www-form-urlencoded; charset=euc-kr',
        },
        data: {
			MID: merchantID,
			EdiDate: ediDate,
            Moid: moid,
			EncData: getAES(aesString, merchantKey),
            SignData: signData,
            CharSet: 'utf-8'    
        } 
    });

    console.log('λΉν‚¤ λ°κΈ‰ κ²°κ³Ό:', response.data);
    res.json(response.data);
})

// μΉ΄λ“ μ •λ³΄λ¥Ό μ•”νΈν™”ν•κΈ° μ„ν• AES-128-ECB μ•”νΈν™” ν•¨μμ…λ‹λ‹¤.
function getAES(text, key){
    const encKey = key.substr(0,16);
    
    const cipher = crypto.createCipheriv('aes-128-ecb', encKey, Buffer.alloc(0));
    const ciphertext = Buffer.concat([cipher.update(text, 'utf8'), cipher.final()]).toString('hex');

    return ciphertext;
}

//μ„λ³€μ΅° κ²€μ¦μ„ μ„ν• SHA-256 μ•”νΈν™” λ°©μ‹μ…λ‹λ‹¤.
function getSignData(str) {
    const encrypted = CryptoJS.SHA256(str);
    return encrypted;
}

```

### 4. python κµ¬ν„

```python
import os
from datetime import datetime
import random
import hashlib
import requests
import json
from flask import Flask, render_template, request
from cryptography.hazmat.backends import default_backend
from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes
from cryptography.hazmat.primitives.padding import PKCS7
from Crypto.Cipher import AES
from Crypto.Util.Padding import pad, unpad
from Crypto.Random import get_random_bytes

app = Flask(__name__)

# μΉ΄λ“ μ •λ³΄λ¥Ό μ•”νΈν™”ν•κΈ° μ„ν• AES-128-ECB μ•”νΈν™” ν•¨μμ…λ‹λ‹¤.
class AES128:
    def __init__(self, key: bytes):
        self.key = key
        self.backend = default_backend()

    def encrypt(self, data: bytes) -> bytes:
        padder = PKCS7(128).padder()
        encryptor = Cipher(algorithm=algorithms.AES(self.key), mode=modes.ECB(), backend=self.backend).encryptor()

        padded_data = padder.update(data) + padder.finalize()
        EncData = encryptor.update(padded_data) + encryptor.finalize()

        return EncData

# μ„λ³€μ΅° κ²€μ¦μ„ μ„ν• SHA-256 μ•”νΈν™” ν•¨μμ…λ‹λ‹¤.
def getSignData(str):
    encoded_str = str.encode()
    EncryptData = hashlib.sha256(encoded_str).hexdigest()
    return EncryptData

# API μ”μ²­ μ „λ¬Έ μƒμ„± μ‹ μ‹κ°„ μ •λ³΄λ¥Ό μ €μ¥ν•©λ‹λ‹¤. 
def getEdiDate():
    YYYYmmddHHMMSS = datetime.today().strftime("%Y%m%d%H%M%S")
    return str(YYYYmmddHHMMSS)

# API μ”μ²­μ„ μ„ν• Header μ •λ³΄λ¥Ό μ„Έν… ν›„ μ‹¤μ  APIλ¥Ό νΈμ¶ν•κ³  κ²°κ³Όκ°’μ„ μ¶λ ¥ν•λ” ν•¨μμ…λ‹λ‹¤.    
def authRequest(url, data):
    headers = {
        'Content-type' : 'application/x-www-form-urlencoded', 'charset': 'euc-kr'
    }
    
    response = requests.post(
        url=url,
        data=data, 
        headers=headers
    )

    resDict = json.loads(response.text)
    print(resDict)

    return resDict


# κ°€λ§Ήμ κ΄€λ¦¬μ νμ΄μ§€(npg.nicepay.co.kr) λ΅κ·ΈμΈ > κ°€λ§Ήμ  μ •λ³΄ > Keyκ΄€λ¦¬
# μƒκΈ° κ²½λ΅λ¥Ό ν†µν•΄μ„ κ°€λ§Ήμ  μ•„μ΄λ””μΈ MIDμ™€ κ°€λ§Ήμ  ν‚¤ κ°’μ„ ν™•μΈν•μ—¬ 
# μ•„λ merchantID, merchantKey νλΌλ―Έν„°μ— κ°κ° μ…λ ¥ν•©λ‹λ‹¤.  

MID				= "nictest04m"																					# κ°€λ§Ήμ  μ•„μ΄λ””(MID)
MerchantKey		= "b+zhZ4yOZ7FsH8pm5lhDfHZEb79tIwnjsdA0FBXh86yLc6BJeFVrZFXhAoJ3gEWgrWwN+lJMV0W4hvDdbe4Sjw=="	# κ°€λ§Ήμ  ν‚¤
key				= "b+zhZ4yOZ7FsH8pm" 																		    # κ°€λ§Ήμ  ν‚¤ μ• 16μλ¦¬ - μΉ΄λ“μ •λ³΄ μ•”νΈν™” μ‹ μ‚¬μ©λλ” Keyκ°’


# μ•„λ νλΌλ―Έν„°μ— μ”μ²­ν•  κ°’μ„ μ•λ§κ² μ…λ ¥ν•©λ‹λ‹¤. 

BuyerEmail	  	= ""                                # κµ¬λ§¤μλ©”μΌμ£Όμ†
BuyerName 	 	= ""                                # κµ¬λ§¤μλ… 
BuyerTel  		= ""                                # κµ¬λ§¤μμ—°λ½μ² 
EdiDate   	  	= getEdiDate()                      # κ±°λ λ‚ μ§   
Moid      	  	= ""                                # μƒν’μ£Όλ¬Έλ²νΈ  
CardNo    	  	= ""                                # μΉ΄λ“λ²νΈ
ExpYear   	  	= ""                                # μ ν¨κΈ°κ°„(λ…„)
ExpMonth  	  	= ""                                # μ ν¨κΈ°κ°„(μ›”)
IDNo      	  	= ""                                # μ£Όλ―Όλ²νΈ λλ” μ‚¬μ—…μλ²νΈ
CardPw    	  	= ""                                # μΉ΄λ“ λΉ„λ°€λ²νΈ μ• 2μλ¦¬



# λΉν‚¤ λ°κΈ‰ μ”μ²­
@app.route( methods=['POST'])
def billkeyReq():   
    MID=MID
    Moid=Moid
    CardNo=CardNo
    ExpYear=ExpYear
    ExpMonth=ExpMonth
    IDNo=IDNo
    CardPw=CardPw
    EdiDate=getEdiDate()
    
    # Key=Value ν•νƒμ Plain-Textλ΅ μΉ΄λ“μ •λ³΄λ¥Ό λ‚μ—΄ν• ν›„ μ•”νΈν™”ν•©λ‹λ‹¤. 
    plainText="CardNo="+CardNo+"&ExpYear="+ExpYear+"&ExpMonth="+ExpMonth+"&IDNo="+IDNo+"&CardPw="+CardPw
    aes128=AES128(key=key.encode())
    EncData=aes128.encrypt(data=plainText.encode()).hex()

    # λ°μ΄ν„° μ„λ³€μ΅° κ²€μ¦κ°’μ„ μƒμ„±ν•©λ‹λ‹¤. (κ±°λ μ„λ³€μ΅°λ¥Ό λ§‰κΈ° μ„ν• λ°©λ²•μ…λ‹λ‹¤. μμ •μ„ κΈμ§€ν•©λ‹λ‹¤.)
    SignData=getSignData(MID + EdiDate + Moid + MerchantKey)

    # λΉν‚¤ λ°κΈ‰ API μ”μ²­μ„ μ„ν• Target URL μ…λ‹λ‹¤.
    billkeyURL="https://webapi.nicepay.co.kr/webapi/billing/billing_regist.jsp"

    # λ…μ„Έμ„λ¥Ό μ°Έκ³ ν•μ—¬ ν•„μ”μ— λ”°λΌ νλΌλ―Έν„°μ™€ κ°’μ„ 'key': 'value' ν•νƒλ΅ μ¶”κ°€ν•΄μ£Όμ„Έμ”.
    data = {
        'MID': MID,
        'EdiDate': EdiDate,
        'Moid': Moid, 
        'EncData': EncData,
        'SignData': SignData
    }
	
    # billkeyURLλ΅ dataλ¥Ό μ „λ‹¬ν•μ—¬ APIλ¥Ό νΈμ¶ν•©λ‹λ‹¤.
    resDict = authRequest(billkeyURL, data)

    # κ²°κ³Όλ¥Ό μ‘λ‹µλ°›μ•„ 'result.html'μ— κ°’μ„ μ „λ‹¬ν•©λ‹λ‹¤.
    return render_template(
        'result.html',
        result=resDict
    )

if __name__ == '__main__':
    app.run(debug=True)
```

## λΉλ§ κ²°μ (μΉμΈ)
- **URL**: `https://webapi.nicepay.co.kr/webapi/billing/billing_approve.jsp`
- **HTTP λ©”μ„λ“**: POST
- **Content-Type**: `application/x-www-form-urlencoded`
- λΉλ§ μΉμΈμ€ λ°κΈ‰λ BID(λΉν‚¤)λ΅ π’³ κ²°μ (μΉμΈ)λ¥Ό μ§„ν–‰ν•λ” μ„λΉ„μ¤
- λ°κΈ‰λ λΉν‚¤λ¥Ό ν†µν•΄ billing_approve.jsp APIλ¥Ό νΈμ¶ν•λ©΄ κ²°μ (μΉμΈ) μ²λ¦¬κ°€ μ™„λ£

### μ”μ²­ λ…μ„Έ 
| νλΌλ―Έν„°λ…       | κΈΈμ΄ | ν•„μ | μ„¤λ… |
|----------------|------|------|------|
| BID            | 30B  | Y  | λΉν‚¤ |
| MID            | 10B  | Y  | κ°€λ§Ήμ  ID |
| TID            | 30B  | Y  | κ±°λ ID, λΉν‚¤ λ°κΈ‰ μ‹ μ‘λ‹µλ°›μ€ TID κ·Έλ€λ΅ μ‚¬μ© μ‹ μ¤λ¥ λ°μƒ (μΉμΈ TID μ¤‘λ³µ μ¤λ¥), λ°λ“μ‹ μƒλ΅ μƒμ„±ν•μ—¬ μ‚¬μ©ν•  κ²ƒ. |
| EdiDate        | 14B  | Y  | μ „λ¬Έμƒμ„±μΌμ‹ (YYYYMMDDHHMMSS) |
| Moid           | 64B  | Y  | κ°€λ§Ήμ μ—μ„ λ¶€μ—¬ν• μ£Όλ¬Έλ²νΈ (Uniqueν•κ² κµ¬μ„±) |
| Amt            | 12B  | Y  | κ²°μ  κΈμ•΅ (μ«μλ§ μ…λ ¥) |
| GoodsName      | 40B  | Y  | μƒν’λ… (" λ“± νΉμκΈ°νΈ μ‚¬μ© μ‹ λ³„λ„ λ¬Έμ) |
| SignData       | 256B | Y  | hex(sha256(MID + EdiDate + Moid + Amt + BID + MerchantKey)), μ„λ³€μ΅° κ²€μ¦ λ°μ΄ν„° |
| CardInterest   | 1B   | Y  | κ°€λ§Ήμ  λ¶„λ‹΄ λ¬΄μ΄μ ν• λ¶€ μ΄λ²¤νΈ μ‚¬μ© μ—¬λ¶€ (0: λ―Έμ‚¬μ©, 1: μ‚¬μ©(λ¬΄μ΄μ)) |
| CardQuota      | 2B   | Y  | ν• λ¶€κ°μ›” (00: μΌμ‹λ¶, 02: 2κ°μ›”, 03: 3κ°μ›”, ...) |
| BuyerEmail     | 60B  |  | λ©”μΌμ£Όμ† |
| BuyerTel       | 20B  |  | κµ¬λ§¤μ μ—°λ½μ² |
| BuyerName      | 30B  |  | κµ¬λ§¤μλ… |
| CharSet        | 10B  |  | μΈμ¦ μ‘λ‹µ μΈμ½”λ”© (euc-kr(default) / utf-8) |
| EdiType        | 10B  |  | μ‘λ‹µμ „λ¬Έ μ ν• (JSON / KV) *KV:Key=value |
| MallReserved   | 500B |  | κ°€λ§Ήμ  μ—¬λ¶„ν•„λ“ (λ‚μ΄μ¤νμ΄ κ°€κ³µ μ—†μ) |

### μ‘λ‹µ λ…μ„Έ 
| νλΌλ―Έν„°λ…       | κΈΈμ΄ | ν•„μ | μ„¤λ… |
|----------------|------|------|------|
| ResultCode     | 4B   | Y   | κ²°κ³Όμ½”λ“ (3001: μ„±κ³µ / κ·Έμ™Έ μ‹¤ν¨) |
| ResultMsg      | 100B | Y   | κ²°κ³Ό λ©”μ‹μ§€ |
| TID            | 30B  | Y   | κ±°λ ID |
| Moid           | 64B  | Y   | μ£Όλ¬Έλ²νΈ |
| Amt            | 12B  | Y   | κΈμ•΅, (μ, 1000μ›μΈ κ²½μ° -> 000000001000) |
| AuthCode       | 30 B |  | μΉμΈλ²νΈ |
| AuthDate       | 12 B |  | μΉμΈμΌμ‹(YYMMDDHHMISS) |
| AcquCardCode   | 4 B  |  | λ§¤μ… μΉ΄λ“μ‚¬ μ½”λ“ |
| AcquCardName   | 20 B |  | λ§¤μ… μΉ΄λ“μ‚¬λ… |
| CardNo         | 20 B |  | μΉ΄λ“λ²νΈ(μΌλ¶€ λ§μ¤ν‚Ή μ²λ¦¬ μ, 12345678****1234) |
| CardCode       | 4 B  |  | μΉ΄λ“μ‚¬ μ½”λ“ |
| CardName       | 20 B |  | μΉ΄λ“μ‚¬λ… |
| CardQuota      | 2 B  |  | ν• λ¶€κ°μ›” |
| CardCl         | 1 B  |  | μΉ΄λ“νƒ€μ… (0: μ‹ μ©μΉ΄λ“, 1: μ²΄ν¬μΉ΄λ“) |
| CcPartCl       | 1 B  |  | λ¶€λ¶„μ·¨μ† κ°€λ¥ μ—¬λ¶€ (0: λ¶κ°€λ¥, 1: κ°€λ¥) |
| CardInterest   | 1 B  |  | λ¬΄μ΄μ μ—¬λ¶€ (0: μ΄μ, 1: λ¬΄μ΄μ) |
| MallReserved   | 500 B|  | κ°€λ§Ήμ  μ—¬λ¶„ν•„λ“ (μ”μ²­ μ‹ Data κ·Έλ€λ΅ μ „λ‹¬) |

## λΉν‚¤ κ²°μ (μΉμΈ) μƒν”μ½”λ“
### 1. Java/JSP κµ¬ν„

```jsp
<%@ page contentType="text/html; charset=euc-kr"%>
<%@ page import="java.util.Date" %>
<%@ page import="java.util.HashMap" %>
<%@ page import="java.util.Iterator" %>
<%@ page import="java.io.PrintWriter" %>
<%@ page import="java.io.BufferedReader" %>
<%@ page import="java.io.InputStreamReader" %>
<%@ page import="java.net.URL" %>
<%@ page import="java.net.URLEncoder" %>
<%@ page import="java.net.HttpURLConnection" %>
<%@ page import="java.text.SimpleDateFormat" %>
<%@ page import="java.security.MessageDigest" %>
<%@ page import="org.json.simple.JSONObject" %>
<%@ page import="org.json.simple.parser.JSONParser" %>
<%@ page import="org.apache.commons.codec.binary.Hex" %>
<%@ page import="java.util.StringTokenizer" %>
<%
request.setCharacterEncoding("euc-kr"); 

/*
****************************************************************************************
* <μ”μ²­ κ°’ μ •λ³΄>
* μ•„λ νλΌλ―Έν„°μ— μ”μ²­ν•  κ°’μ„ μ•λ§κ² μ…λ ¥ν•©λ‹λ‹¤.
****************************************************************************************
*/
String BID 			= ""; 	// λΉλ§ν‚¤
String MID 			= "nictest04m";	// μƒμ  ID
String Moid			= ""; 	// μ£Όλ¬Έλ²νΈ
String Amt 			= ""; 	// κ²°μ κΈμ•΅
String GoodsName 	= ""; 	// μƒν’λ…
String CardInterest = "";	// λ¬΄μ΄μμ—¬λ¶€
String CardQuota 	= ""; 	// ν• λ¶€κ°μ›”

//μ”μ²­ν•  κ±°λλ²νΈ(TID)λ¥Ό μƒμ„±ν•©λ‹λ‹¤.
String TID = makeTID(MID, "01", "16");

//κ²°κ³Ό μ½”λ“μ™€ λ©”μ„Έμ§€λ¥Ό μ €μ¥ν•  λ³€μλ¥Ό λ―Έλ¦¬ μ„ μ–Έν•©λ‹λ‹¤.
String ResultCode 	= "";
String ResultMsg 	= "";

/*
**********************************************************
* <ν•΄μ‰¬μ•”νΈν™”> (μμ •ν•μ§€ λ§μ„Έμ”)
* SHA-256 ν•΄μ‰¬μ•”νΈν™”λ” κ±°λ μ„λ³€μ΅°λ¥Ό λ§‰κΈ°μ„ν• λ°©λ²•μ…λ‹λ‹¤. 
**********************************************************
*/
DataEncrypt sha256Enc 	= new DataEncrypt();
String ediDate 			= getyyyyMMddHHmmss();
String SignData 		= sha256Enc.encrypt(MID + ediDate + Moid + Amt + BID + merchantKey);

/*
****************************************************************************************
* <μΉμΈ μ”μ²­>
* μΉμΈμ— ν•„μ”ν• λ°μ΄ν„° μƒμ„± ν›„ server to server ν†µμ‹ μ„ ν†µν•΄ μΉμΈ μ²λ¦¬ ν•©λ‹λ‹¤.
* λ…μ„Έμ„λ¥Ό μ°Έκ³ ν•μ—¬ ν•„μ”μ— λ”°λΌ νλΌλ―Έν„°μ™€ κ°’μ„ Key=Value ν•νƒλ΅ μ¶”κ°€ν•΄μ£Όμ„Έμ”.
****************************************************************************************
*/
StringBuffer requestData = new StringBuffer();
requestData.append("TID=").append(TID).append("&");
requestData.append("BID=").append(BID).append("&");
requestData.append("MID=").append(MID).append("&");
requestData.append("EdiDate=").append(ediDate).append("&");
requestData.append("Moid=").append(Moid).append("&");
requestData.append("Amt=").append(Amt).append("&");
requestData.append("GoodsName=").append(URLEncoder.encode(GoodsName, "euc-kr")).append("&");
requestData.append("CardInterest=").append(CardInterest).append("&");
requestData.append("CardQuota=").append(CardQuota).append("&");
requestData.append("SignData=").append(SignData);
	
//API νΈμ¶, κ²°κ³Ό λ°μ΄ν„°κ°€ resultJsonStr λ³€μμ— μ €μ¥λ©λ‹λ‹¤.
String resultJsonStr = connectToServer(requestData.toString(), "https://webapi.nicepay.co.kr/webapi/billing/billing_approve.jsp");

//κ²°κ³Ό λ°μ΄ν„°λ¥Ό HashMap ν•νƒλ΅ λ³€ν™ν•©λ‹λ‹¤.
HashMap resultData = new HashMap();
resultData = jsonStringToHashMap(resultJsonStr);

ResultCode 	= (String)resultData.get("ResultCode");
ResultMsg 	= (String)resultData.get("ResultMsg");

%>
<!DOCTYPE html>
<html>
<head>
<title>NICEPAY BILLING SAMPLE</title>
<meta charset="euc-kr">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes, target-densitydpi=medium-dpi" />
<link rel="stylesheet" type="text/css" href="../css/import.css"/>
</head>
<body> 
<div class="payfin_area">
	<div class="top">λΉν‚¤ μΉμΈ κ²°κ³Ό</div>
	<div class="conwrap">
		<div class="con">
			<div class="tabletypea">
				<table>
					<colgroup><col width="200px"/><col width="*"/></colgroup>
					<tr>
						<th><span>λΉν‚¤μΉμΈ κ²°κ³Ό λ‚΄μ©</span></th>
						<td>[<%=ResultCode%>]<%=ResultMsg%></td>
					</tr>
					<tr>
						<th><span>λΉν‚¤μΉμΈ μ‘λ‹µ λ°μ΄ν„°</span></th>
						<td><%=resultJsonStr%></td>
					</tr>
				</table>
			</div>
		</div>
		<p>*ν…μ¤νΈ μ•„μ΄λ””μΈκ²½μ° λ‹ΉμΌ μ¤ν›„ 11μ‹ 30λ¶„μ— μ·¨μ†λ©λ‹λ‹¤.</p>
	</div>
</div>
</body>
</html>
<%!
//μ¤‘μ”!. κ°€λ§Ήμ  MIDμ— λ§λ” keyκ°’μ„ μ„¤μ •ν•μ„Έμ”.
static final String merchantKey = "b+zhZ4yOZ7FsH8pm5lhDfHZEb79tIwnjsdA0FBXh86yLc6BJeFVrZFXhAoJ3gEWgrWwN+lJMV0W4hvDdbe4Sjw==";	//nictest04mμ μƒμ ν‚¤

//yyyyMMddHHmmss ν•μ‹ date μƒμ„± ν•¨μ
public final synchronized String getyyyyMMddHHmmss(){
	SimpleDateFormat yyyyMMddHHmmss = new SimpleDateFormat("yyyyMMddHHmmss");
	return yyyyMMddHHmmss.format(new Date());
}

// SHA-256 ν•μ‹μΌλ΅ μ•”νΈν™”
public static class DataEncrypt{
	MessageDigest md;
	String strSRCData = "";
	String strENCData = "";
	String strOUTData = "";
	
	public DataEncrypt(){ }
	public String encrypt(String strData){
		String passACL = null;
		MessageDigest md = null;
		try{
			md = MessageDigest.getInstance("SHA-256");
			md.reset();
			md.update(strData.getBytes());
			byte[] raw = md.digest();
			passACL = encodeHex(raw);
		}catch(Exception e){
			System.out.print("μ•”νΈν™” μ—λ¬" + e.toString());
		}
		return passACL;
	}
	
	public String encodeHex(byte [] b){
		char [] c = Hex.encodeHex(b);
		return new String(c);
	}
}

/**
 * λ€μ™Έ ν†µμ‹  μƒν”.
 *  μ™Έλ¶€ κΈ°κ΄€κ³Ό URL ν†µμ‹ ν•λ” μƒν” ν•¨μ μ…λ‹λ‹¤.
 *  μƒν”μ†μ¤λ” μ„λΉ„μ¤ μ•μ •μ„±μ„ λ³΄μ¥ν•μ§€ μ•μΌλ―€λ΅, κ°€λ§Ήμ  ν™κ²½μ— λ§κ² κµ¬ν„ λ°”λλ‹λ‹¤.
 *  μƒν”μ†μ¤ μ΄μ©μ— λ”°λ¥Έ μ΄μ λ°μƒμ‹ NICEPAYμ—μ„ μ±…μ„μ§€μ§€ μ•μµλ‹λ‹¤. 
*/
public static String connectToServer(String data, String reqUrl) throws Exception{
	HttpURLConnection conn 		= null;
	BufferedReader resultReader = null;
	PrintWriter pw 				= null;
	URL url 					= null;
	
	int statusCode = 0;
	StringBuffer recvBuffer = new StringBuffer();
	try{
		url = new URL(reqUrl);
		conn = (HttpURLConnection) url.openConnection();
		conn.setRequestMethod("POST");
		conn.setConnectTimeout(15000);
		conn.setReadTimeout(25000);
		conn.setDoOutput(true);
		
		pw = new PrintWriter(conn.getOutputStream());
		pw.write(data);
		pw.flush();
		
		statusCode = conn.getResponseCode();
		resultReader = new BufferedReader(new InputStreamReader(conn.getInputStream(), "euc-kr"));
		for(String temp; (temp = resultReader.readLine()) != null;){
			recvBuffer.append(temp).append("\n");
		}
		
		if(!(statusCode == HttpURLConnection.HTTP_OK)){
			throw new Exception("ERROR");
		}
		
		return recvBuffer.toString().trim();
	}catch (Exception e){
		return "ERROR";
	}finally{
		recvBuffer.setLength(0);
		
		try{
			if(resultReader != null){
				resultReader.close();
			}
		}catch(Exception ex){
			resultReader = null;
		}
		
		try{
			if(pw != null) {
				pw.close();
			}
		}catch(Exception ex){
			pw = null;
		}
		
		try{
			if(conn != null) {
				conn.disconnect();
			}
		}catch(Exception ex){
			conn = null;
		}
	}
}

//jsonν•νƒμ Stringμ„ HashMapμΌλ΅ λ³€ν™ν•΄μ£Όλ” ν•¨μμ…λ‹λ‹¤. 
private static HashMap jsonStringToHashMap(String str) throws Exception{
	HashMap dataMap = new HashMap();
	JSONParser parser = new JSONParser();
	try{
		Object obj = parser.parse(str);
		JSONObject jsonObject = (JSONObject)obj;

		Iterator<String> keyStr = jsonObject.keySet().iterator();
		while(keyStr.hasNext()){
			String key = keyStr.next();
			Object value = jsonObject.get(key);
			
			dataMap.put(key, value);
		}
	}catch(Exception e){
		
	}
	return dataMap;
}

/**
 *  TID μƒμ„±μƒν”.
 *  makeTID() ν•¨μλ” λ°μ΄ν„°μ μ μΌμ„±μ„ λ³΄μ¥ν•μ§€ μ•μµλ‹λ‹¤.
 *  λ°λ“μ‹ κ°€λ§Ήμ ν™κ²½μ— λ§κ² uniqueν• κ°’μ„ μƒμ„±ν•  μ μλ„λ΅ κµ¬ν„ λ°”λλ‹λ‹¤.
 *  μƒν”μ†μ¤ μ΄μ©μ— λ”°λ¥Έ μ΄μ λ°μƒμ‹ NICEPAYμ—μ„ μ±…μ„μ§€μ§€ μ•μµλ‹λ‹¤.
*/
public static String makeTID(String mid, String svcCd, String prdtCd){
	SimpleDateFormat sdf = new SimpleDateFormat("yyMMddHHmmss");
	String yyMMddHHmmss = sdf.format(new Date());
	
	StringBuffer sb = new StringBuffer(mid);
	sb.append(svcCd);
	sb.append(prdtCd);
	sb.append(yyMMddHHmmss);
	sb.append(String.valueOf(Math.random()).substring(2, 6));
	return sb.toString();
}
%>
%>
```

### 2. PHP κµ¬ν„

```php
<?php
header("Content-Type:text/html; charset=euc-kr;"); 

// λΉλ§ κ²°μ (μΉμΈ) API μ”μ²­ URL
$postURL = "https://webapi.nicepay.co.kr/webapi/billing/billing_approve.jsp";

/*
****************************************************************************************
* (μ”μ²­ κ°’ μ •λ³΄)
* μ•„λ νλΌλ―Έν„°μ— μ”μ²­ν•  κ°’μ„ μ•λ§κ² μ…λ ¥ν•©λ‹λ‹¤. 
****************************************************************************************
*/
$bid 				= "";				// λΉν‚¤
$mid 				= "nictest04m";		// κ°€λ§Ήμ  μ•„μ΄λ””
$tid 				= "";				// κ±°λ ID
$moid 				= "";				// κ°€λ§Ήμ  μ£Όλ¬Έλ²νΈ
$amt 				= "";				// κ²°μ  κΈμ•΅
$goodsName 			= "";				// μƒν’λ…
$cardInterest 		= "";				// λ¬΄μ΄μ μ—¬λ¶€
$cardQuota 			= "";				// ν• λ¶€ κ°μ›” μ 
$buyerName 			= "";				// κµ¬λ§¤μλ…
$buyerTel 			= "";				// κµ¬λ§¤μ μ „ν™”λ²νΈ
$buyerEmail 		= "";				// κµ¬λ§¤μ μ΄λ©”μΌ


// κ²°κ³Ό λ°μ΄ν„°λ¥Ό μ €μ¥ν•  λ³€μλ¥Ό λ―Έλ¦¬ μ„ μ–Έν•©λ‹λ‹¤.
$response = "";

/*
****************************************************************************************
* (ν•΄μ‰¬μ•”νΈν™” - μμ •ν•μ§€ λ§μ„Έμ”)
* SHA-256 ν•΄μ‰¬μ•”νΈν™”λ” κ±°λ μ„λ³€μ΅°λ¥Ό λ§‰κΈ°μ„ν• λ°©λ²•μ…λ‹λ‹¤. 
****************************************************************************************
*/	
$ediDate = date("YmdHis");																					// API μ”μ²­ μ „λ¬Έ μƒμ„±μΌμ‹
$merchantKey = "b+zhZ4yOZ7FsH8pm5lhDfHZEb79tIwnjsdA0FBXh86yLc6BJeFVrZFXhAoJ3gEWgrWwN+lJMV0W4hvDdbe4Sjw==";	// κ°€λ§Ήμ  ν‚¤	
$signData = bin2hex(hash('sha256', $mid . $ediDate . $moid . $amt . $bid . $merchantKey, true));			// μ„λ³€μ΅° λ°μ΄ν„° κ²€μ¦ κ°’ μ•”νΈν™”


/*
****************************************************************************************
* (API μ”μ²­λ¶€)
* λ…μ„Έμ„λ¥Ό μ°Έκ³ ν•μ—¬ ν•„μ”μ— λ”°λΌ νλΌλ―Έν„°μ™€ κ°’μ„ 'key'=>'value' ν•νƒλ΅ μ¶”κ°€ν•΄μ£Όμ„Έμ”
****************************************************************************************
*/
$data = Array(
	'BID' => $bid,
	'MID' => $mid,
	'TID' => $tid,
	'EdiDate' => $ediDate,
	'Moid' => $moid,
	'Amt' => $amt,
	'GoodsName' => $goodsName,
	'SignData' => $signData,
	'CardInterest' => $cardInterest,
	'CardQuota' => $cardQuota
);		

$response = reqPost($data, $postURL); 				//API νΈμ¶, κ²°κ³Ό λ°μ΄ν„°κ°€ $response λ³€μμ— μ €μ¥λ©λ‹λ‹¤.
jsonRespDump($response); 							//κ²°κ³Ό λ°μ΄ν„°λ¥Ό λΈλΌμ°μ €μ— λ…Έμ¶ν•©λ‹λ‹¤.
	
// jsonμΌλ΅ μ‘λ‹µλ κ²°κ³Ό λ°μ΄ν„°λ¥Ό λ°°μ—΄ ν•νƒλ΅ λ³€ν™ν•μ—¬ μ¶λ ¥ν•λ” ν•¨μμ…λ‹λ‹¤. 
// μ‘λ‹µ λ°μ΄ν„° μ¶λ ¥μ„ μ„ν• μμ‹λ΅ ν…μ¤νΈ μ΄ν›„ κ°€λ§Ήμ  μƒν™©μ— λ§κ² λ³€κ²½ν•©λ‹λ‹¤. 
function jsonRespDump($resp){
	$resp_utf = iconv("EUC-KR", "UTF-8", $resp); 
	$respArr = json_decode($resp_utf);
	foreach ( $respArr as $key => $value ){
		echo "$key=". iconv("UTF-8", "EUC-KR", $value)."<br />";
	}
}

// APIλ¥Ό POST ν•νƒλ΅ νΈμ¶ν•λ” ν•¨μμ…λ‹λ‹¤. 
function reqPost(Array $data, $url){
	$ch = curl_init();
	curl_setopt($ch, CURLOPT_URL, $url);
	curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
	curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 15);					//connection timeout 15 
	curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
	curl_setopt($ch, CURLOPT_POSTFIELDS, http_build_query($data));	//POST data
	curl_setopt($ch, CURLOPT_POST, true);
	$response = curl_exec($ch);
	curl_close($ch);	 
	return $response;
}
?>
```

### 3. node κµ¬ν„

```nodejs
const express = require('express')
const axios = require('axios')
const app = express()
const port = 3000
const iconv = require('iconv-lite')
const bodyParser = require('body-parser')
const crypto = require('crypto')
const CryptoJS = require('crypto-js')
const format = require('date-format')
const fs = require('fs')
const ejs = require('ejs')

/*
****************************************************************************************
* κ°€λ§Ήμ κ΄€λ¦¬μ νμ΄μ§€(npg.nicepay.co.kr) λ΅κ·ΈμΈ > κ°€λ§Ήμ  μ •λ³΄ > Keyκ΄€λ¦¬
* μƒκΈ° κ²½λ΅λ¥Ό ν†µν•΄μ„ κ°€λ§Ήμ  μ•„μ΄λ””μΈ MIDμ™€ κ°€λ§Ήμ  ν‚¤ κ°’μ„ ν™•μΈν•μ—¬ 
* μ•„λ merchantID, merchantKey νλΌλ―Έν„°μ— κ°κ° μ…λ ¥ν•©λ‹λ‹¤.  
****************************************************************************************
*/
const merchantKey = 'b+zhZ4yOZ7FsH8pm5lhDfHZEb79tIwnjsdA0FBXh86yLc6BJeFVrZFXhAoJ3gEWgrWwN+lJMV0W4hvDdbe4Sjw=='; // κ°€λ§Ήμ  ν‚¤
const merchantID = 'nictest04m'; // κ°€λ§Ήμ  ID

// API μ”μ²­ μ „λ¬Έ μƒμ„± μ‹ μ‹κ°„ μ •λ³΄λ¥Ό μ €μ¥ν•©λ‹λ‹¤. 
const ediDate = format.asString('yyyyMMddhhmmss', new Date()); // API μ”μ²­ μ „λ¬Έ μƒμ„±μΌμ‹

// μ•„λ νλΌλ―Έν„°μ— μ”μ²­κ°’ μ •λ³΄λ¥Ό μ•λ§κ² μ…λ ¥ν•©λ‹λ‹¤. 
const bid = '';               // λΉν‚¤
const amt = '';              	// κΈμ•΅
const goodsName = '';   		// μƒν’λ…
const moid = '';            	// κ°€λ§Ήμ  μ£Όλ¬Έλ²νΈ
const cardInterest = '';   	// λ¬΄μ΄μ μ—¬λ¶€
const cardQuota = '';     	// ν• λ¶€ κ°μ›” μ

app.use(express.static('public'))
app.use(bodyParser.urlencoded({ extended: false }))

// λΉλ§ κ²°μ (μΉμΈ) μ”μ²­
app.post('/billing', async function(req, res){

    // μ”μ²­ν•  κ±°λλ²νΈ(TID)λ¥Ό μƒμ„±ν•©λ‹λ‹¤.
    const ranNum = Math.floor(Math.random()*(9999-1000+1)) + 1000;
    const transactionID = merchantID + "0116" + ediDate.substr(2,12) + ranNum;
    
    // λ°μ΄ν„° μ„λ³€μ΅° κ²€μ¦κ°’μ„ μƒμ„±ν•©λ‹λ‹¤. (κ±°λ μ„λ³€μ΅°λ¥Ό λ§‰κΈ° μ„ν• λ°©λ²•μ…λ‹λ‹¤. μμ •μ„ κΈμ§€ν•©λ‹λ‹¤.)
    const signData = getSignData(merchantID + ediDate + moid + amt + bid + merchantKey).toString();

    // λΉλ§ κ²°μ (μΉμΈ) API μ”μ²­μ„ μ„ν• Target URL, Header λ° form dataλ¥Ό μ…λ ¥ν•©λ‹λ‹¤.
	// λΉλ§ κ²°μ (μΉμΈ) API μ”μ²­ ν›„ μ‘λ‹µμ„ λ°›μ•„ consoleκ³Ό λΈλΌμ°μ €μ— μ¶λ ¥ν•©λ‹λ‹¤.
    const response = await axios({
        url: 'https://webapi.nicepay.co.kr/webapi/billing/billing_approve.jsp',
        method: 'POST',
        headers: {
            'User-Agent': 'Super Agent/0.0.1',
            'Content-Type': 'application/x-www-form-urlencoded; charset=euc-kr',
        },
        data: {
            TID: transactionID,
			BID: bid,
			MID: merchantID,
			EdiDate: ediDate,
            Moid: moid,
			Amt: amt,
			GoodsName: goodsName,
            SignData: signData,
			CardInterest: cardInterest,
			CardQuota: cardQuota,
            CharSet: 'utf-8'    
        } 
    });

    console.log('μΉμΈ κ²°κ³Ό:', response.data);
    res.json(response.data);

})

// μ„λ³€μ΅° κ²€μ¦μ„ μ„ν• SHA-256 μ•”νΈν™” ν•¨μμ…λ‹λ‹¤.
function getSignData(str) {
    const encrypted = CryptoJS.SHA256(str);
    return encrypted;
}

```

### 4. python κµ¬ν„

```python
import os
from datetime import datetime
import random
import hashlib
import requests
import json
from flask import Flask, render_template, request
from cryptography.hazmat.backends import default_backend
from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes
from cryptography.hazmat.primitives.padding import PKCS7
from Crypto.Cipher import AES
from Crypto.Util.Padding import pad, unpad
from Crypto.Random import get_random_bytes

app = Flask(__name__)


# μ„λ³€μ΅° κ²€μ¦μ„ μ„ν• SHA-256 μ•”νΈν™” ν•¨μμ…λ‹λ‹¤.
def getSignData(str):
    encoded_str = str.encode()
    EncryptData = hashlib.sha256(encoded_str).hexdigest()
    return EncryptData

# API μ”μ²­ μ „λ¬Έ μƒμ„± μ‹ μ‹κ°„ μ •λ³΄λ¥Ό μ €μ¥ν•©λ‹λ‹¤. 
def getEdiDate():
    YYYYmmddHHMMSS = datetime.today().strftime("%Y%m%d%H%M%S")
    return str(YYYYmmddHHMMSS)

# API μ”μ²­μ„ μ„ν• Header μ •λ³΄λ¥Ό μ„Έν… ν›„ μ‹¤μ  APIλ¥Ό νΈμ¶ν•κ³  κ²°κ³Όκ°’μ„ μ¶λ ¥ν•λ” ν•¨μμ…λ‹λ‹¤.    
def authRequest(url, data):
    headers = {
        'Content-type' : 'application/x-www-form-urlencoded', 'charset': 'euc-kr'
    }
    
    response = requests.post(
        url=url,
        data=data, 
        headers=headers
    )

    resDict = json.loads(response.text)
    print(resDict)

    return resDict

# TID μƒμ„± κ·μΉ™μ— λ§κ² κ±°λμΌμ‹(YYMMDDHHMISS)λ¥Ό ν•¨μμ…λ‹λ‹¤.
def TIME():
    YYmmddHHMMSS = datetime.today().strftime("%y%m%d%H%M%S")
    return str(YYmmddHHMMSS)

# TID μƒμ„± κ·μΉ™μ— λ§κ² λ’¤ λλ¤ 4μλ¦¬λ¥Ό μƒμ„±ν•λ” ν•¨μμ…λ‹λ‹¤.
def RANDOM():
    a = [random.randint(0, 9) for _ in range(4)]
    s = str("".join(map(str, a)))
    return str(s)

# κ°€λ§Ήμ κ΄€λ¦¬μ νμ΄μ§€(npg.nicepay.co.kr) λ΅κ·ΈμΈ > κ°€λ§Ήμ  μ •λ³΄ > Keyκ΄€λ¦¬
# μƒκΈ° κ²½λ΅λ¥Ό ν†µν•΄μ„ κ°€λ§Ήμ  μ•„μ΄λ””μΈ MIDμ™€ κ°€λ§Ήμ  ν‚¤ κ°’μ„ ν™•μΈν•μ—¬ 
# μ•„λ merchantID, merchantKey νλΌλ―Έν„°μ— κ°κ° μ…λ ¥ν•©λ‹λ‹¤.  

MID				= "nictest04m"																					# κ°€λ§Ήμ  μ•„μ΄λ””(MID)
MerchantKey		= "b+zhZ4yOZ7FsH8pm5lhDfHZEb79tIwnjsdA0FBXh86yLc6BJeFVrZFXhAoJ3gEWgrWwN+lJMV0W4hvDdbe4Sjw=="	# κ°€λ§Ήμ  ν‚¤


# TIME(), RANDOM() ν•¨μλ¥Ό ν†µν•΄ μƒμ„±ν• μ‹κ°„ μ •λ³΄μ™€ λλ¤ 4μλ¦¬ κ°’μ„ κ°€μ Έμ™€ API μ”μ²­μ— ν•„μ”ν• κ±°λλ²νΈ(TID)λ¥Ό μƒμ„±ν•©λ‹λ‹¤.
# κ°€λ§Ήμ  ν™κ²½μ— λ§κ² TIDλ¥Ό uniqueν•κ² μƒμ„±ν•  μ μλ„λ΅ λ³„λ„ κµ¬ν„ν•λ” κ²ƒμ„ κ¶μ¥ν•©λ‹λ‹¤. 

time = TIME()                                      	# TID μƒμ„±κ·μΉ™-μ”μ²­μ‹κ°
random = RANDOM()                            		# TID μƒμ„±κ·μΉ™-λλ¤4μλ¦¬
TID = MID + "0116" + time + random      			# κ±°λλ²νΈ 

# μ•„λ νλΌλ―Έν„°μ— μ”μ²­ν•  κ°’μ„ μ•λ§κ² μ…λ ¥ν•©λ‹λ‹¤. 
BID 			= ""                                # λΉν‚¤
Amt       	 	= ""                                # κ²°μ μƒν’κΈμ•΅
BuyerEmail	  	= ""                                # κµ¬λ§¤μλ©”μΌμ£Όμ†
BuyerName 	 	= ""                                # κµ¬λ§¤μλ… 
BuyerTel  		= ""                                # κµ¬λ§¤μμ—°λ½μ² 
EdiDate   	  	= getEdiDate()                      # κ±°λ λ‚ μ§   
GoodsName 	  	= ""                                # κ²°μ μƒν’λ…
Moid      	  	= ""                                # μƒν’μ£Όλ¬Έλ²νΈ  
CardInterest 	= ""                                # λ¬΄μ΄μ μ—¬λ¶€(0 : μ μ΄μ / 1 : λ¬΄μ΄μ)
CardQuota		= ""						        # μΉ΄λ“ ν• λ¶€κ°μ›” μ

# λΉλ§ κ²°μ (μΉμΈ) μ”μ²­
@app.route( methods=['POST'])
def billApproveReq():
    TID = TID 
    BID = BID
    MID = MID
    Moid = Moid
    Amt = Amt
    GoodsName = GoodsName
    CardInterest = CardInterest
    CardQuota = CardQuota
    EdiDate = getEdiDate()

    # λ°μ΄ν„° μ„λ³€μ΅° κ²€μ¦κ°’μ„ μƒμ„±ν•©λ‹λ‹¤. (κ±°λ μ„λ³€μ΅°λ¥Ό λ§‰κΈ° μ„ν• λ°©λ²•μ…λ‹λ‹¤. μμ •μ„ κΈμ§€ν•©λ‹λ‹¤.)
    SignData = getSignData(MID + EdiDate + Moid + Amt + BID + MerchantKey)
    
    # κ²°μ (μΉμΈ) API μ”μ²­μ„ μ„ν• Target URL μ…λ‹λ‹¤.
    billApproveURL = "https://webapi.nicepay.co.kr/webapi/billing/billing_approve.jsp"
     
    # λ…μ„Έμ„λ¥Ό μ°Έκ³ ν•μ—¬ ν•„μ”μ— λ”°λΌ νλΌλ―Έν„°μ™€ κ°’μ„ 'key': 'value' ν•νƒλ΅ μ¶”κ°€ν•΄μ£Όμ„Έμ”.
    data = {
        'TID': TID,
        'BID': BID,
        'MID': MID,
        'EdiDate': EdiDate,
        'Moid': Moid,
        'Amt': Amt,
        'GoodsName': GoodsName,
        'SignData': SignData,
        'CardInterest': CardInterest,
        'CardQuota': CardQuota
    }
    
    # billApproveURLλ΅ dataλ¥Ό μ „λ‹¬ν•μ—¬ APIλ¥Ό νΈμ¶ν•©λ‹λ‹¤.
    resDict = authRequest(billApproveURL, data)

    # κ²°κ³Όλ¥Ό μ‘λ‹µλ°›μ•„ 'result.html'μ— κ°’μ„ μ „λ‹¬ν•©λ‹λ‹¤.
    return render_template(
        'result.html',
        result=resDict
    )

if __name__ == '__main__':
    app.run(debug=True)
```


## λΉν‚¤ μ‚­μ 
- **URL**: `https://webapi.nicepay.co.kr/webapi/billing/billkey_remove.jsp`
- **HTTP λ©”μ„λ“**: POST
- **Content-Type**: `application/x-www-form-urlencoded`
- λΉν‚¤ μ‚­μ λ” λ°κΈ‰λ BID(λΉν‚¤)λ¥Ό β‚μ‚­μ ν•λ” μ„λΉ„μ¤
- λ°κΈ‰λ λΉν‚¤ μ¤‘ μ‚­μ ν•κ³ μ ν•λ” λΉν‚¤μ— λ€ν•μ—¬ billkey_remove.jsp APIλ¥Ό νΈμ¶ν•λ©΄ μ‚­μ  μ²λ¦¬κ°€ μ™„λ£
- μ‚­μ κ°€ μ™„λ£λ λΉν‚¤λ” λ³µμ› λ° κ²°μ κ°€ λ¶κ°€

### μ”μ²­ λ…μ„Έ 
| νλΌλ―Έν„°λ…       | κΈΈμ΄ | ν•„μ | μ„¤λ… |
|----------------|------|------|------|
| BID            | 30B  | Y  | λΉν‚¤ |
| MID            | 10B  | Y  | κ°€λ§Ήμ  ID |
| EdiDate        | 14B  | Y  | μ „λ¬Έμƒμ„±μΌμ‹ (YYYYMMDDHHMMSS) |
| Moid           | 64B  | Y  | κ°€λ§Ήμ μ—μ„ λ¶€μ—¬ν• μ£Όλ¬Έλ²νΈ (Uniqueν•κ² κµ¬μ„±) |
| Amt            | 12B  | Y  | κ²°μ  κΈμ•΅ (μ«μλ§ μ…λ ¥) |
| SignData       | 256B | Y  | hex(sha256(MID + EdiDate + Moid + Amt + BID + MerchantKey)), μ„λ³€μ΅° κ²€μ¦ λ°μ΄ν„° |
| CharSet        | 10B  |  | μΈμ¦ μ‘λ‹µ μΈμ½”λ”© (euc-kr(default) / utf-8) |
| EdiType        | 10B  |  | μ‘λ‹µμ „λ¬Έ μ ν• (JSON / KV) *KV:Key=value |

### μ‘λ‹µ λ…μ„Έ 
| νλΌλ―Έν„°λ…       | κΈΈμ΄ | ν•„μ | μ„¤λ… |
|----------------|------|------|------|
| ResultCode     | 4B   | Y   | κ²°κ³Όμ½”λ“ (F101: μ„±κ³µ / κ·Έμ™Έ μ‹¤ν¨) |
| ResultMsg      | 100B | Y   | κ²°κ³Ό λ©”μ‹μ§€ |
| TID            | 30B  | Y   | κ±°λ ID |
| BID            | 30B  | Y   | λΉλ§ ν‚¤ |
| AuthDate       | 8B |  | μ‚­μ μΌμ(YYYYMMDD) |


## λΉν‚¤ μ‚­μ  μƒν”μ½”λ“
### 1. Java/JSP κµ¬ν„

```jsp
<%@ page contentType="text/html; charset=euc-kr"%>
<%@ page import="java.util.Date" %>
<%@ page import="java.util.HashMap" %>
<%@ page import="java.util.Iterator" %>
<%@ page import="java.io.PrintWriter" %>
<%@ page import="java.io.BufferedReader" %>
<%@ page import="java.io.InputStreamReader" %>
<%@ page import="java.net.URL" %>
<%@ page import="java.net.URLEncoder" %>
<%@ page import="java.net.HttpURLConnection" %>
<%@ page import="java.text.SimpleDateFormat" %>
<%@ page import="java.security.MessageDigest" %>
<%@ page import="org.json.simple.JSONObject" %>
<%@ page import="org.json.simple.parser.JSONParser" %>
<%@ page import="org.apache.commons.codec.binary.Hex" %>
<%@ page import="java.util.StringTokenizer" %>
<%
request.setCharacterEncoding("euc-kr"); 

/*
****************************************************************************************
* <μ”μ²­ κ°’ μ •λ³΄>
* μ•„λ νλΌλ―Έν„°μ— μ”μ²­ν•  κ°’μ„ μ•λ§κ² μ…λ ¥ν•©λ‹λ‹¤.
****************************************************************************************
*/
String BID 			= "";	// λΉλ§ν‚¤
String MID 			= "nictest04m";	// μƒμ  ID
String Moid			= "";	// μ£Όλ¬Έλ²νΈ

//κ²°κ³Ό μ½”λ“μ™€ λ©”μ„Έμ§€λ¥Ό μ €μ¥ν•  λ³€μλ¥Ό λ―Έλ¦¬ μ„ μ–Έν•©λ‹λ‹¤.
String ResultCode 	= "";
String ResultMsg 	= "";

/*
*******************************************************
* <ν•΄μ‰¬μ•”νΈν™”> (μμ •ν•μ§€ λ§μ„Έμ”)
* SHA-256 ν•΄μ‰¬μ•”νΈν™”λ” κ±°λ μ„λ³€μ΅°λ¥Ό λ§‰κΈ°μ„ν• λ°©λ²•μ…λ‹λ‹¤. 
*******************************************************
*/
DataEncrypt sha256Enc 	= new DataEncrypt();
String ediDate 			= getyyyyMMddHHmmss();
String SignData 		= sha256Enc.encrypt(MID + ediDate + Moid + BID + merchantKey);

/*
****************************************************************************************
* <λΉν‚¤ μ‚­μ  μ”μ²­>
* λΉν‚¤ μ‚­μ μ— ν•„μ”ν• λ°μ΄ν„° μƒμ„± ν›„ server to server ν†µμ‹ μ„ ν†µν•΄ μΉμΈ μ²λ¦¬ ν•©λ‹λ‹¤.
* λ…μ„Έμ„λ¥Ό μ°Έκ³ ν•μ—¬ ν•„μ”μ— λ”°λΌ νλΌλ―Έν„°μ™€ κ°’μ„ Key=Value ν•νƒλ΅ μ¶”κ°€ν•΄μ£Όμ„Έμ”.
****************************************************************************************
*/
StringBuffer requestData = new StringBuffer();
requestData.append("BID=").append(BID).append("&");
requestData.append("MID=").append(MID).append("&");
requestData.append("EdiDate=").append(ediDate).append("&");
requestData.append("Moid=").append(Moid).append("&");
requestData.append("SignData=").append(SignData);

//API νΈμ¶, κ²°κ³Ό λ°μ΄ν„°κ°€ resultJsonStr λ³€μμ— μ €μ¥λ©λ‹λ‹¤.
String resultRecvMsg = connectToServer(requestData.toString(), "https://webapi.nicepay.co.kr/webapi/billing/billkey_remove.jsp");

//κ²°κ³Ό λ°μ΄ν„°λ¥Ό HashMap ν•νƒλ΅ λ³€ν™ν•©λ‹λ‹¤.
HashMap resultData = new HashMap();
resultData = jsonStringToHashMap(resultRecvMsg);

ResultCode 	= (String)resultData.get("ResultCode");
ResultMsg 	= (String)resultData.get("ResultMsg");

%>
<!DOCTYPE html>
<html>
<head>
<title>NICEPAY BILLKEY REMOVE RESULT(EUC-KR) SAMPLE</title>
<meta charset="euc-kr">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes, target-densitydpi=medium-dpi" />
<link rel="stylesheet" type="text/css" href="../css/import.css"/>
</head>
<body> 
<div class="payfin_area">
	<div class="top">λΉν‚¤ μ‚­μ  κ²°κ³Ό</div>
	<div class="conwrap">
		<div class="con">
			<div class="tabletypea">
				<table>
					<colgroup><col width="200px"/><col width="*"/></colgroup>
					<tr>
						<th><span>λΉν‚¤μ‚­μ  κ²°κ³Ό λ‚΄μ©</span></th>
						<td>[<%=ResultCode%>]<%=ResultMsg%></td>
					</tr>
					<tr>
						<th><span>λΉν‚¤μ‚­μ  μ‘λ‹µ λ°μ΄ν„°</span></th>
						<td><%=resultRecvMsg%></td>
					</tr>
				</table>
			</div>
		</div>
	</div>
</div>
</body>
</html>
<%!
//μ¤‘μ”!. κ°€λ§Ήμ  MIDμ— λ§λ” keyκ°’μ„ μ„¤μ •ν•μ„Έμ”.
static final String merchantKey = "b+zhZ4yOZ7FsH8pm5lhDfHZEb79tIwnjsdA0FBXh86yLc6BJeFVrZFXhAoJ3gEWgrWwN+lJMV0W4hvDdbe4Sjw==";	//nictest04mμ μƒμ ν‚¤

//yyyyMMddHHmmss ν•μ‹ date μƒμ„± ν•¨μ
public final synchronized String getyyyyMMddHHmmss(){
	SimpleDateFormat yyyyMMddHHmmss = new SimpleDateFormat("yyyyMMddHHmmss");
	return yyyyMMddHHmmss.format(new Date());
}

// SHA-256 ν•μ‹μΌλ΅ μ•”νΈν™”
public static class DataEncrypt{
	MessageDigest md;
	String strSRCData = "";
	String strENCData = "";
	String strOUTData = "";
	
	public DataEncrypt(){ }
	public String encrypt(String strData){
		String passACL = null;
		MessageDigest md = null;
		try{
			md = MessageDigest.getInstance("SHA-256");
			md.reset();
			md.update(strData.getBytes());
			byte[] raw = md.digest();
			passACL = encodeHex(raw);
		}catch(Exception e){
			System.out.print("μ•”νΈν™” μ—λ¬" + e.toString());
		}
		return passACL;
	}
	
	public String encodeHex(byte [] b){
		char [] c = Hex.encodeHex(b);
		return new String(c);
	}
}

/**
 * λ€μ™Έ ν†µμ‹  μƒν”.
 *  μ™Έλ¶€ κΈ°κ΄€κ³Ό URL ν†µμ‹ ν•λ” μƒν” ν•¨μ μ…λ‹λ‹¤.
 *  μƒν”μ†μ¤λ” μ„λΉ„μ¤ μ•μ •μ„±μ„ λ³΄μ¥ν•μ§€ μ•μΌλ―€λ΅, κ°€λ§Ήμ  ν™κ²½μ— λ§κ² κµ¬ν„ λ°”λλ‹λ‹¤.
 *  μƒν”μ†μ¤ μ΄μ©μ— λ”°λ¥Έ μ΄μ λ°μƒμ‹ NICEPAYμ—μ„ μ±…μ„μ§€μ§€ μ•μµλ‹λ‹¤. 
*/
public static String connectToServer(String data, String reqUrl) throws Exception{
	HttpURLConnection conn 		= null;
	BufferedReader resultReader = null;
	PrintWriter pw 				= null;
	URL url 					= null;
	
	int statusCode = 0;
	StringBuffer recvBuffer = new StringBuffer();
	try{
		url = new URL(reqUrl);
		conn = (HttpURLConnection) url.openConnection();
		conn.setRequestMethod("POST");
		conn.setConnectTimeout(15000);
		conn.setReadTimeout(25000);
		conn.setDoOutput(true);
		
		pw = new PrintWriter(conn.getOutputStream());
		pw.write(data);
		pw.flush();
		
		statusCode = conn.getResponseCode();
		resultReader = new BufferedReader(new InputStreamReader(conn.getInputStream(), "euc-kr"));
		for(String temp; (temp = resultReader.readLine()) != null;){
			recvBuffer.append(temp).append("\n");
		}
		
		if(!(statusCode == HttpURLConnection.HTTP_OK)){
			throw new Exception("ERROR");
		}
		
		return recvBuffer.toString().trim();
	}catch (Exception e){
		return "ERROR";
	}finally{
		recvBuffer.setLength(0);
		
		try{
			if(resultReader != null){
				resultReader.close();
			}
		}catch(Exception ex){
			resultReader = null;
		}
		
		try{
			if(pw != null) {
				pw.close();
			}
		}catch(Exception ex){
			pw = null;
		}
		
		try{
			if(conn != null) {
				conn.disconnect();
			}
		}catch(Exception ex){
			conn = null;
		}
	}
}

//jsonν•νƒμ Stringμ„ HashMapμΌλ΅ λ³€ν™ν•΄μ£Όλ” ν•¨μμ…λ‹λ‹¤. 
private static HashMap jsonStringToHashMap(String str) throws Exception{
	HashMap dataMap = new HashMap();
	JSONParser parser = new JSONParser();
	try{
		Object obj = parser.parse(str);
		JSONObject jsonObject = (JSONObject)obj;

		Iterator<String> keyStr = jsonObject.keySet().iterator();
		while(keyStr.hasNext()){
			String key = keyStr.next();
			Object value = jsonObject.get(key);
			
			dataMap.put(key, value);
		}
	}catch(Exception e){
		
	}
	return dataMap;
}

%>
```

### 2. PHP κµ¬ν„

```php
<?php
header("Content-Type:text/html; charset=euc-kr;"); 

// λΉν‚¤ μ‚­μ  API μ”μ²­ URL
$postURL = "https://webapi.nicepay.co.kr/webapi/billing/billkey_remove.jsp";

/*
****************************************************************************************
* (μ”μ²­ κ°’ μ •λ³΄)
* μ•„λ νλΌλ―Έν„°μ— μ”μ²­ν•  κ°’μ„ μ•λ§κ² μ…λ ¥ν•©λ‹λ‹¤. 
****************************************************************************************
*/
$bid 		= "";							// λΉν‚¤
$mid 		= "nictest04m";					// κ°€λ§Ήμ  μ•„μ΄λ””
$moid 		= "";							// κ°€λ§Ήμ  μ£Όλ¬Έλ²νΈ

// κ²°κ³Ό λ°μ΄ν„°λ¥Ό μ €μ¥ν•  λ³€μλ¥Ό λ―Έλ¦¬ μ„ μ–Έν•©λ‹λ‹¤. 
$response = "";

/*
****************************************************************************************
* (ν•΄μ‰¬μ•”νΈν™” - μμ •ν•μ§€ λ§μ„Έμ”)
* SHA-256 ν•΄μ‰¬μ•”νΈν™”λ” κ±°λ μ„λ³€μ΅°λ¥Ό λ§‰κΈ°μ„ν• λ°©λ²•μ…λ‹λ‹¤. 
****************************************************************************************
*/	
$ediDate = date("YmdHis");																					// API μ”μ²­ μ „λ¬Έ μƒμ„±μΌμ‹
$merchantKey = "b+zhZ4yOZ7FsH8pm5lhDfHZEb79tIwnjsdA0FBXh86yLc6BJeFVrZFXhAoJ3gEWgrWwN+lJMV0W4hvDdbe4Sjw=="; 	// κ°€λ§Ήμ  ν‚¤
$signData = bin2hex(hash('sha256', $mid . $ediDate . $moid . $bid . $merchantKey, true));					// μ„λ³€μ΅° λ°μ΄ν„° κ²€μ¦ κ°’ μ•”νΈν™”

/*
****************************************************************************************
* (API μ”μ²­λ¶€)
* λ…μ„Έμ„λ¥Ό μ°Έκ³ ν•μ—¬ ν•„μ”μ— λ”°λΌ νλΌλ―Έν„°μ™€ κ°’μ„ 'key'=>'value' ν•νƒλ΅ μ¶”κ°€ν•΄μ£Όμ„Έμ”
****************************************************************************************
*/		
$data = Array(
	'BID' => $bid,
	'MID' => $mid,
	'EdiDate' => $ediDate,
	'Moid' => $moid,
	'SignData' => $signData
);		

$response = reqPost($data, $postURL); 				//API νΈμ¶, κ²°κ³Ό λ°μ΄ν„°κ°€ $response λ³€μμ— μ €μ¥λ©λ‹λ‹¤.
jsonRespDump($response); 							//κ²°κ³Ό λ°μ΄ν„°λ¥Ό λΈλΌμ°μ €μ— λ…Έμ¶ν•©λ‹λ‹¤.
		
	
	
// jsonμΌλ΅ μ‘λ‹µλ κ²°κ³Ό λ°μ΄ν„°λ¥Ό λ°°μ—΄ ν•νƒλ΅ λ³€ν™ν•μ—¬ μ¶λ ¥ν•λ” ν•¨μμ…λ‹λ‹¤. 
// μ‘λ‹µ λ°μ΄ν„° μ¶λ ¥μ„ μ„ν• μμ‹λ΅ ν…μ¤νΈ μ΄ν›„ κ°€λ§Ήμ  μƒν™©μ— λ§κ² λ³€κ²½ν•©λ‹λ‹¤. 
function jsonRespDump($resp){
	$resp_utf = iconv("EUC-KR", "UTF-8", $resp); 
	$respArr = json_decode($resp_utf);
	foreach ( $respArr as $key => $value ){
		echo "$key=". iconv("UTF-8", "EUC-KR", $value)."<br />";
	}
}

// APIλ¥Ό POST ν•νƒλ΅ νΈμ¶ν•λ” ν•¨μμ…λ‹λ‹¤. 
function reqPost(Array $data, $url){
	$ch = curl_init();
	curl_setopt($ch, CURLOPT_URL, $url);
	curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
	curl_setopt($ch, CURLOPT_CONNECTTIMEOUT, 15);					//connection timeout 15 
	curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
	curl_setopt($ch, CURLOPT_POSTFIELDS, http_build_query($data));	//POST data
	curl_setopt($ch, CURLOPT_POST, true);
	$response = curl_exec($ch);
	curl_close($ch);	 
	return $response;
}
?>
```

### 3. node κµ¬ν„

```nodejs
const express = require('express')
const axios = require('axios')
const app = express()
const port = 3000
const iconv = require('iconv-lite')
const bodyParser = require('body-parser')
const crypto = require('crypto')
const CryptoJS = require('crypto-js')
const format = require('date-format')
const fs = require('fs')
const ejs = require('ejs')

/*
****************************************************************************************
* κ°€λ§Ήμ κ΄€λ¦¬μ νμ΄μ§€(npg.nicepay.co.kr) λ΅κ·ΈμΈ > κ°€λ§Ήμ  μ •λ³΄ > Keyκ΄€λ¦¬
* μƒκΈ° κ²½λ΅λ¥Ό ν†µν•΄μ„ κ°€λ§Ήμ  μ•„μ΄λ””μΈ MIDμ™€ κ°€λ§Ήμ  ν‚¤ κ°’μ„ ν™•μΈν•μ—¬ 
* μ•„λ merchantID, merchantKey νλΌλ―Έν„°μ— κ°κ° μ…λ ¥ν•©λ‹λ‹¤.  
****************************************************************************************
*/
const merchantKey = 'b+zhZ4yOZ7FsH8pm5lhDfHZEb79tIwnjsdA0FBXh86yLc6BJeFVrZFXhAoJ3gEWgrWwN+lJMV0W4hvDdbe4Sjw=='; // κ°€λ§Ήμ  ν‚¤
const merchantID = 'nictest04m'; // κ°€λ§Ήμ  ID

// API μ”μ²­ μ „λ¬Έ μƒμ„± μ‹ μ‹κ°„ μ •λ³΄λ¥Ό μ €μ¥ν•©λ‹λ‹¤. 
const ediDate = format.asString('yyyyMMddhhmmss', new Date()); // API μ”μ²­ μ „λ¬Έ μƒμ„±μΌμ‹

// μ•„λ νλΌλ―Έν„°μ— μ”μ²­κ°’ μ •λ³΄λ¥Ό μ•λ§κ² μ…λ ¥ν•©λ‹λ‹¤. 
const bid = '';               	// λΉν‚¤
const moid = '';            	// κ°€λ§Ήμ  μ£Όλ¬Έλ²νΈ

app.use(express.static('public'))
app.use(bodyParser.urlencoded({ extended: false }))

// λΉν‚¤ μ‚­μ  μ”μ²­
app.post('/bidRemove', async function(req, res){

    // λ°μ΄ν„° μ„λ³€μ΅° κ²€μ¦κ°’μ„ μƒμ„±ν•©λ‹λ‹¤. (κ±°λ μ„λ³€μ΅°λ¥Ό λ§‰κΈ° μ„ν• λ°©λ²•μ…λ‹λ‹¤. μμ •μ„ κΈμ§€ν•©λ‹λ‹¤.)
    const signData = getSignData(merchantID + ediDate + moid + bid + merchantKey).toString();
    
	// λΉν‚¤ μ‚­μ  API μ”μ²­ ν›„ μ‘λ‹µμ„ λ°›μ•„ consoleκ³Ό λΈλΌμ°μ €μ— μ¶λ ¥ν•©λ‹λ‹¤.
    const response = await axios({
        url: 'https://webapi.nicepay.co.kr/webapi/billing/billkey_remove.jsp',
        method: 'POST',
        headers: {
            'User-Agent': 'Super Agent/0.0.1',
            'Content-Type': 'application/x-www-form-urlencoded; charset=euc-kr',
        },
        data: {
            BID: bid,
			MID: merchantID,
			EdiDate: ediDate,
            Moid: moid,
            SignData: signData,
            CharSet: 'utf-8'    
        } 
    });

    console.log('λΉν‚¤ μ‚­μ  κ²°κ³Ό:', response.data);
    res.json(response.data);
})

// μ„λ³€μ΅° κ²€μ¦μ„ μ„ν• SHA-256 μ•”νΈν™” ν•¨μμ…λ‹λ‹¤.
function getSignData(str) {
    const encrypted = CryptoJS.SHA256(str);
    return encrypted;
}


app.listen(port, () => console.log('**\n\nPAYMENT TEST URL:: localhost:3000/payment\nCANCEL TEST URL:: localhost:3000/cancel \n\n**'))
```

### 4. python κµ¬ν„

```python
import os
from datetime import datetime
import random
import hashlib
import requests
import json
from flask import Flask, render_template, request
from cryptography.hazmat.backends import default_backend
from cryptography.hazmat.primitives.ciphers import Cipher, algorithms, modes
from cryptography.hazmat.primitives.padding import PKCS7
from Crypto.Cipher import AES
from Crypto.Util.Padding import pad, unpad
from Crypto.Random import get_random_bytes

app = Flask(__name__)

# μ„λ³€μ΅° κ²€μ¦μ„ μ„ν• SHA-256 μ•”νΈν™” ν•¨μμ…λ‹λ‹¤.
def getSignData(str):
    encoded_str = str.encode()
    EncryptData = hashlib.sha256(encoded_str).hexdigest()
    return EncryptData

# API μ”μ²­ μ „λ¬Έ μƒμ„± μ‹ μ‹κ°„ μ •λ³΄λ¥Ό μ €μ¥ν•©λ‹λ‹¤. 
def getEdiDate():
    YYYYmmddHHMMSS = datetime.today().strftime("%Y%m%d%H%M%S")
    return str(YYYYmmddHHMMSS)

# API μ”μ²­μ„ μ„ν• Header μ •λ³΄λ¥Ό μ„Έν… ν›„ μ‹¤μ  APIλ¥Ό νΈμ¶ν•κ³  κ²°κ³Όκ°’μ„ μ¶λ ¥ν•λ” ν•¨μμ…λ‹λ‹¤.    
def authRequest(url, data):
    headers = {
        'Content-type' : 'application/x-www-form-urlencoded', 'charset': 'euc-kr'
    }
    
    response = requests.post(
        url=url,
        data=data, 
        headers=headers
    )

    resDict = json.loads(response.text)
    print(resDict)

    return resDict

# κ°€λ§Ήμ κ΄€λ¦¬μ νμ΄μ§€(npg.nicepay.co.kr) λ΅κ·ΈμΈ > κ°€λ§Ήμ  μ •λ³΄ > Keyκ΄€λ¦¬
# μƒκΈ° κ²½λ΅λ¥Ό ν†µν•΄μ„ κ°€λ§Ήμ  μ•„μ΄λ””μΈ MIDμ™€ κ°€λ§Ήμ  ν‚¤ κ°’μ„ ν™•μΈν•μ—¬ 
# μ•„λ merchantID, merchantKey νλΌλ―Έν„°μ— κ°κ° μ…λ ¥ν•©λ‹λ‹¤.  

MID				= "nictest04m"																					# κ°€λ§Ήμ  μ•„μ΄λ””(MID)
MerchantKey		= "b+zhZ4yOZ7FsH8pm5lhDfHZEb79tIwnjsdA0FBXh86yLc6BJeFVrZFXhAoJ3gEWgrWwN+lJMV0W4hvDdbe4Sjw=="	# κ°€λ§Ήμ  ν‚¤

# μ•„λ νλΌλ―Έν„°μ— μ”μ²­ν•  κ°’μ„ μ•λ§κ² μ…λ ¥ν•©λ‹λ‹¤. 
BID 			= ""                                # λΉν‚¤
EdiDate   	  	= getEdiDate()                      # κ±°λ λ‚ μ§   
Moid      	  	= ""                                # μƒν’μ£Όλ¬Έλ²νΈ  

# λΉν‚¤ μ‚­μ  μ”μ²­
@app.route( methods=['POST'])
def billkeyRemoveReq():
    MID = MID
    EdiDate = getEdiDate()
    Moid = Moid
    BID = BID

    # λ°μ΄ν„° μ„λ³€μ΅° κ²€μ¦κ°’μ„ μƒμ„±ν•©λ‹λ‹¤. (κ±°λ μ„λ³€μ΅°λ¥Ό λ§‰κΈ° μ„ν• λ°©λ²•μ…λ‹λ‹¤. μμ •μ„ κΈμ§€ν•©λ‹λ‹¤.)
    SignData = getSignData(MID + EdiDate + Moid + BID + MerchantKey)
    
    #λΉν‚¤ μ‚­μ  API μ”μ²­μ„ μ„ν• Target URL μ…λ‹λ‹¤.
    billkeyRemoveURL = "https://webapi.nicepay.co.kr/webapi/billing/billkey_remove.jsp"

	# λ…μ„Έμ„λ¥Ό μ°Έκ³ ν•μ—¬ ν•„μ”μ— λ”°λΌ νλΌλ―Έν„°μ™€ κ°’μ„ 'key': 'value' ν•νƒλ΅ μ¶”κ°€ν•΄μ£Όμ„Έμ”.
    data = {
        'MID': MID,
        'EdiDate': EdiDate,
        'Moid': Moid,
        'BID': BID,
        'SignData': SignData
    }
    
    # billkeyRemoveURLλ΅ dataλ¥Ό μ „λ‹¬ν•μ—¬ APIλ¥Ό νΈμ¶ν•©λ‹λ‹¤.
    resDict = authRequest(billkeyRemoveURL, data)

    # κ²°κ³Όλ¥Ό μ‘λ‹µλ°›μ•„ 'result.html'μ— κ°’μ„ μ „λ‹¬ν•©λ‹λ‹¤.
    return render_template(
        'result.html',
        result=resDict
    )

if __name__ == '__main__':
    app.run(debug=True)
```
---
