# Nicepay API 2.0 - APP (iOS/Android)
- https://developers.nicepay.co.kr/manual-app.php

## âœ… ì¤€ë¹„í•˜ê¸°  
- í•˜ì´ë¸Œë¦¬ë“œ App ì—°ë™ì„ ìœ„í•´ ë¨¼ì € **Nicepay Web ê²°ì œ êµ¬ì„±**ì´ ì™„ë£Œë˜ì–´ì•¼ í•©ë‹ˆë‹¤.  
- Web ê²°ì œ ì„¤ì • ì™„ë£Œ í›„ **ì•±(WebView) ìƒ˜í”Œ ì½”ë“œ**ë¥¼ ì°¸ê³ í•´ ì—°ë™ì„ êµ¬í˜„í•©ë‹ˆë‹¤. ([developers.nicepay.co.kr](https://developers.nicepay.co.kr/manual-app.php?utm_source=chatgpt.com))

## ğŸ“¦ ì§€ì› í™˜ê²½  
- Android: **4.4 (KitKat)** ì´ìƒ  
- iOS: **iOS 9.0** ì´ìƒ  
- Swift: **Swift 4.0** ì´ìƒ (Xcode 7.x ì´ìƒ)

## ğŸ¤– Android ì—°ë™

### 1. Android (Kotlin / Java) ì¤€ë¹„í•˜ê¸°  
- `AndroidManifest.xml`ì— **ì•±ì¹´ë“œ ë° ê°„í¸ê²°ì œ** ì—°ë™ì„ ìœ„í•œ ì—¬ëŸ¬ íŒ¨í‚¤ì§€ëª…ì„ `<queries>` í•­ëª©ìœ¼ë¡œ ë“±ë¡í•©ë‹ˆë‹¤.  
- `INTERNET` ê¶Œí•œê³¼ `usesCleartextTraffic` ì„¤ì •ë„ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.

```AndroidManifest.xml
<?xml version="1.0" encoding="utf-8"?>
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    package="kr.co.nicepay.nicepayappsample">

	<queries>
        <!--ì‹ ìš©ì¹´ë“œ-->
        <package android:name="kr.co.samsungcard.mpocket" />  <!--ì‚¼ì„± ì•±ì¹´ë“œ, ì‚¼ì„± ì•±ì¹´ë“œ ê³µë™ì¸ì¦ì„œ-->
        <package android:name="com.shcard.smartpay" />  <!--ì‹ í•œ í˜ì´íŒ-->
        <package android:name="com.shinhancard.smartshinhan" />  <!--ì‹ í•œ(ARS/ì¼ë°˜ê²°ì œ/Smartê²°ì œ), ì‹ í•œ ê³µë™ì¸ì¦ì„œ-->
        <package android:name="com.kbcard.cxh.appcard" />  <!--KBPay-->
        <package android:name="com.kbstar.liivbank" />  <!--LiiV(êµ­ë¯¼ì€í–‰)-->
        <package android:name="com.kbstar.reboot" />  <!--new liib-->
        <package android:name="kvp.jjy.MispAndroid320" />  <!--í˜ì´ë¶/ISP-->
        <package android:name="com.hanaskcard.paycla" />  <!--í•˜ë‚˜ì¹´ë“œ ì›íí˜ì´-->
        <package android:name="kr.co.hanamembers.hmscustomer" />  <!--í•˜ë‚˜ë©¤ë²„ìŠ¤-->
        <package android:name="com.lcacApp" />  <!--ë¡¯ë° ì•±ì¹´ë“œ-->
        <package android:name="nh.smart.nhallonepay" />  <!--NH ì˜¬ì›í˜ì´, NH ì˜¬ì›í˜ì´ ê³µë™ì¸ì¦ì„œ-->
        <package android:name="com.wooricard.smartapp" />  <!--ìš°ë¦¬ WON ì¹´ë“œ-->
		<package android:name="com.wooribank.smart.npib" />  <!--ìš°ë¦¬ WON ë±…í‚¹-->
        <package android:name="com.hyundaicard.appcard" />  <!--í˜„ëŒ€ ì•±ì¹´ë“œ-->
        <package android:name="kr.co.citibank.citimobile" />  <!--ì”¨í‹°ì¹´ë“œ-->
		<package android:name="com.shinhan.smartcaremgr" />  <!--ì‹ í•œìŠˆí¼SOL-->
		<package android:name="net.ib.android.smcard" />  <!--ì‚¼ì„± monimo-->
		<package android:name="com.kakaobank.channel" />  <!--ì¹´ì¹´ì˜¤ë±…í¬ ì•±ì¹´ë“œ-->

        <!--ê³µì¸ì¸ì¦-->
        <package android:name="com.hanaskcard.rocomo.potal" />  <!--í•˜ë‚˜ì¹´ë“œ-->
        <package android:name="com.lumensoft.touchenappfree" />  <!--ê³µë™ì¸ì¦ì„œ-->

        <!--ë°±ì‹ -->
        <package android:name="com.TouchEn.mVaccine.webs" />  <!--TouchEn mVaccine(ì‹ í•œ)-->
        <package android:name="com.ahnlab.v3mobileplus" />  <!--V3(NH, í˜„ëŒ€)-->
        <package android:name="kr.co.shiftworks.vguardweb" />  <!--V-Guard(ì‚¼ì„±)-->

        <!--ê°„í¸ê²°ì œ-->
        <package android:name="com.samsung.android.spay" />  <!--ì‚¼ì„±í˜ì´(ì‚¼ì„±, ë†í˜‘, KB)-->
        <package android:name="com.samsung.android.spaylite" />  <!--ì‚¼ì„±í˜ì´ ë¯¸ë‹ˆ(ì‚¼ì„±, KB)-->
        <package android:name="com.kakao.talk" />  <!--ì¹´ì¹´ì˜¤í˜ì´-->
        <package android:name="com.nhn.android.search" />  <!--ë„¤ì´ë²„í˜ì´-->
        <package android:name="com.ssg.serviceapp.android.egiftcertificate" />  <!--SSGPay(í˜„ëŒ€)-->
        <package android:name="com.nhnent.payapp" />  <!--í˜ì´ì½”(ì‚¼ì„±, ë†í˜‘, KB)-->
        <package android:name="com.lge.lgpay" />  <!--ì—˜ì§€í˜ì´(ì‚¼ì„±, KB)-->
        <package android:name="com.lottemembers.android" />  <!--LPay-->
		<package android:name="com.tencent.mm" /> <!-- ìœ„ì±—í˜ì´-->
        <package android:name="viva.republica.toss" /> <!-- í† ìŠ¤-->

        <!--ê³„ì¢Œì´ì²´-->
        <package android:name="com.kftc.bankpay.android" />  <!--ê¸ˆê²°ì›-->
		<package android:name="com.kbankwith.smartbank" />  <!--ì¼€ì´ë±…í¬-->


        <!--ë³¸ì¸ì¸ì¦-->
        <package android:name="com.sktelecom.tauth" />  <!--SKT-->
        <package android:name="com.kt.ktauth" />  <!--KT-->
        <package android:name="com.lguplus.smartotp" />  <!--LGT-->
    </queries>

    <uses-permission android:name="android.permission.INTERNET" />

    <application
        android:allowBackup="true"
        android:icon="@mipmap/ic_launcher"
        android:label="@string/app_name"
        android:roundIcon="@mipmap/ic_launcher_round"
        android:supportsRtl="true"
        android:theme="@style/AppTheme"
        android:usesCleartextTraffic="true">
        <activity android:name=".MainActivity">
            <intent-filter>
                <action android:name="android.intent.action.MAIN" />

                <category android:name="android.intent.category.LAUNCHER" />
            </intent-filter>
        </activity>

        <activity
            android:name=".WebViewActivity"
            android:label="NicePay Smart"
            android:configChanges="orientation"
            android:screenOrientation="portrait">
            <intent-filter>
                <action android:name="android.intent.action.VIEW" />
            </intent-filter>
        </activity>

    </application>

</manifest>
```



### 2. ì›¹ë·° ì„¤ì •  
- `JavaScript` ì‹¤í–‰ í—ˆìš© ë° `DOM Storage`, Mixedâ€‘Content ëª¨ë“œ ì„¤ì •  
- **ì¿ í‚¤ í—ˆìš©**ê³¼ **ì„¸ì…˜ ìœ ì§€** ì„¤ì •  
- ìºì‹œ ëª¨ë“œëŠ” **LOAD_DEFAULT**ë¡œ ê¶Œì¥ (LOAD_CACHE_ELSE_NETWORKëŠ” ê¶Œê³ í•˜ì§€ ì•ŠìŒ)

### 3. ê²°ì œ í˜ì´ì§€ í˜¸ì¶œ  
- í…ŒìŠ¤íŠ¸ìš© **MERCHANT_URL**ì€  
  ```
  https://web.nicepay.co.kr/demo/v3/mobileReq.jsp
  ```
  ì—°ë™ ì™„ë£Œ í›„ ì‹¤ì œ ê°€ë§¹ì  URLë¡œ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤.  
- WebViewì˜ `postUrl` ë˜ëŠ” `loadUrl`ì„ ì‚¬ìš©í•œ ê²°ì œ ìš”ì²­ ì „ì†¡

### 4. URI ì²˜ë¦¬ ë° Intent í˜¸ì¶œ  
- WebView ë‚´ íŠ¹ì • scheme(`intent:`, `.apk`, ì¸ì¦ì„œ, ì•± ê´€ë ¨ ë“±)ì— ëŒ€í•œ ì²˜ë¦¬ êµ¬í˜„  
- ì•±ì´ ì„¤ì¹˜ë˜ì§€ ì•Šì€ ê²½ìš° ìë™ìœ¼ë¡œ Google Play ë˜ëŠ” App Storeë¡œ ì´ë™í•˜ë„ë¡ ì„¤ì •

```WebViewClientClass.java
private class WebViewClientClass extends WebViewClient {
    @Override
    public boolean shouldOverrideUrlLoading(WebView view, String url) {
        Log.i(TAG,"url : " + url);

        try {
			if( url != null && (url.startsWith("intent:")
                        || url.contains("market://")
                        || url.contains("vguard")
                        || url.contains("droidxantivirus")
                        || url.contains("v3mobile")
                        || url.contains(".apk")
                        || url.contains("mvaccine")
                        || url.contains("smartwall://")
                        || url.contains("nidlogin://")
						|| url.contains("onestore://")
                        || url.contains("http://m.ahnlab.com/kr/site/download")) ) {

                Intent intent = null;

                try {
                    intent = Intent.parseUri(url, Intent.URI_INTENT_SCHEME);
                } catch (URISyntaxException ex) {
                    Log.e(TAG,"[error] Bad request uri format : [" + url + "] =" + ex.getMessage());
                    return false;
                }

                if( getPackageManager().resolveActivity(intent,0) == null ) {
                    String pkgName = intent.getPackage();
                    if( pkgName != null ) {
                        Uri uri = Uri.parse("market://search?q=pname:" + pkgName);
                        intent = new Intent(Intent.ACTION_VIEW, uri);
                        startActivity(intent);
                    }
                } else {
                    Uri uri = Uri.parse(intent.getDataString());
                    intent = new Intent(Intent.ACTION_VIEW, uri);
                    startActivity(intent);
                }
            } else {
                view.loadUrl(url);
            }
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }

        return true;
    }
}
```

## ğŸ iOS ì—°ë™

### 1. Swift ê¸°ë°˜ ì—°ë™  
- `info.plist`ì— **URL Scheme ë“±ë¡** (ì•±â†’3rd ì•± / 3rd ì•±â†’ê°€ë§¹ì  ì•± ìë™ ì „í™˜ ëª©ì )  
- WebView(`WKWebView`)ë¥¼ ì‚¬ìš©í•´ `PAY_URL` ë¡œë“œí•˜ê³ , payment flow êµ¬í˜„

### 2. Objective-C ê¸°ë°˜ ì—°ë™  
- Swift ë°©ì‹ê³¼ ìœ ì‚¬í•˜ê²Œ `info.plist` URL Scheme ì„¤ì •  
- `WKWebView` ë¡œ ê²°ì œ í˜ì´ì§€ í˜¸ì¶œ, delegate ë°©ì‹ìœ¼ë¡œ URL ì „í™˜ ì œì–´

### 3. JavaScript íŒì—… ì²˜ë¦¬  
- JavaScript alert ë“± íŒì—… ì´ë²¤íŠ¸ ëŒ€ì‘ì„ ìœ„í•œ legate` `W KUIDeêµ¬í˜„  
- ì‚¬ìš©ìì—ê²Œ ë©”ì‹œì§€ íŒì—… ë°©ì‹ ì•ˆë‚´ ë° í™•ì¸ ë²„íŠ¼ ì²˜ë¦¬

### 4. iOS SWIFT Web-view ì—°ë™
```iOS SWIFT Web-view ì—°ë™
func webView(_ webView: WKWebView, decidePolicyFor navigationAction: WKNavigationAction, decisionHandler: @escaping (WKNavigationActionPolicy) -> Void) {
    let request = navigationAction.request
    let optUrl = request.url
    let optUrlScheme = optUrl?.scheme

    guard let url = optUrl, let scheme = optUrlScheme
        else {
            return decisionHandler(WKNavigationActionPolicy.cancel)
    }

    debugPrint("url : \(url)")

    if( scheme != "http" && scheme != "https" ) {
        if( scheme == "ispmobile" && !UIApplication.shared.canOpenURL(url) ) {  //ISP ë¯¸ì„¤ì¹˜ ì‹œ
            UIApplication.shared.openURL(URL(string: "http://itunes.apple.com/kr/app/id369125087?mt=8")!)
        } else if( scheme == "kftc-bankpay" && !UIApplication.shared.canOpenURL(url) ) {    //BANKPAY ë¯¸ì„¤ì¹˜ ì‹œ
            UIApplication.shared.openURL(URL(string: "http://itunes.apple.com/us/app/id398456030?mt=8")!)
        } else {
            if( UIApplication.shared.canOpenURL(url) ) {
                UIApplication.shared.openURL(url)
            } else {
                //1. App ë¯¸ì„¤ì¹˜ í™•ì¸
                //2. info.plist ë‚´ scheme ë“±ë¡ í™•ì¸
            }
        }
    }

    decisionHandler(WKNavigationActionPolicy.allow)
}

```

```iOS Objective-C Web-view ì—°ë™
- (void)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(void (^)(WKNavigationActionPolicy))decisionHandler {
    NSURLRequest *request = navigationAction.request;
    NSURL *url = [request URL];
    NSString *urlScheme = [url scheme];
    
    NSLog(@"url : %@", url);
    
    if( ![urlScheme isEqualToString:@"http"] && ![urlScheme isEqualToString:@"https"] ) {
        if( [urlScheme isEqualToString:@"ispmobile"] && ![[UIApplication sharedApplication] canOpenURL:url] ) {
            //ISP Appê°€ ì„¤ì¹˜ë˜ì–´ ìˆì§€ ì•Šì„ ê²½ìš° ì•±ìŠ¤í† ì–´ë¡œ ì´ë™
            [[UIApplication sharedApplication] openURL:[NSURL URLWithString:@"http://itunes.apple.com/kr/app/id369125087?mt=8"]];
        } else if( [urlScheme isEqualToString:@"kftc-bankpay"] && ![[UIApplication sharedApplication] canOpenURL:url] ) {
            //BANKPAY Appê°€ ì„¤ì¹˜ë˜ì–´ ìˆì§€ ì•Šì„ ê²½ìš° ì•±ìŠ¤í† ì–´ë¡œ ì´ë™
            [[UIApplication sharedApplication] openURL:[NSURL URLWithString:@"http://itunes.apple.com/us/app/id398456030?mt=8"]];
        } else {
            if( [[UIApplication sharedApplication] canOpenURL:url] ) {
                [[UIApplication sharedApplication] openURL:url];    //App ì‹¤í–‰
            } else {
                //1. App ë¯¸ì„¤ì¹˜ í™•ì¸
                //2. info.plist ë‚´ scheme ë“±ë¡ í™•ì¸
            }
        }
    }
    
    decisionHandler(WKNavigationActionPolicyAllow);
}

```
