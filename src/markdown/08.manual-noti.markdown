# Nicepay API 2.0 - ê²°ì œí†µë³´
- https://developers.nicepay.co.kr/manual-noti.php

ê²°ì œê°€ ì™„ë£Œë˜ë©´, ìŠ¹ì¸ ê²°ê³¼ ë°ì´í„°ë¥¼ ê°€ë§¹ì ì´ ë¯¸ë¦¬ ì„¤ì •í•œ **URL ë˜ëŠ” IP ì£¼ì†Œ**ë¡œ ì „ì†¡í•˜ëŠ” ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.  
ê°€ìƒê³„ì¢Œ ê²°ì œì˜ ê²½ìš°, ì…ê¸ˆ í™•ì¸ ì‹œì ì— í†µë³´ê°€ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.

## ê°œìš”
- ê²°ì œ ì™„ë£Œ í›„, ê°€ë§¹ì  ì„œë²„ì—ì„œ ì‘ë‹µì„ ë°›ì„ ìˆ˜ ìˆë„ë¡ ì„¤ì •í•œ **Return URL ë˜ëŠ” Notify URL**ì— HTTP POST ë°©ì‹ìœ¼ë¡œ ìŠ¹ì¸ ê²°ê³¼ ì „ë‹¬
- ê°€ìƒê³„ì¢Œì˜ ê²½ìš°, ì…ê¸ˆ ì™„ë£Œ í›„ ìŠ¹ì¸ ì²˜ë¦¬ ì‹œì ì— í†µë³´

## ğŸ“Œ Notification ì£¼ìš” ìš”ì†Œ

### âœ… í†µë³´ ë°ì´í„° ì£¼ìš” í•„ë“œ (ì˜ˆì‹œ)
- `resultCode` : ì²˜ë¦¬ ê²°ê³¼ ì½”ë“œ
- `resultMsg` : ê²°ê³¼ ë©”ì‹œì§€
- `tid` : ê±°ë˜ ì‹ë³„ì
- `orderId` : ê°€ë§¹ì  ì£¼ë¬¸ë²ˆí˜¸
- `amount` : ê²°ì œê¸ˆì•¡
- `payMethod` : ê²°ì œ ìˆ˜ë‹¨ (ì¹´ë“œ, ê³„ì¢Œì´ì²´, ê°€ìƒê³„ì¢Œ ë“±)
- ê¸°íƒ€: `currency`, `buyerEmail`, `signature`, `authToken` ë“±

### ğŸ” ë³´ì•ˆ ë° ìœ„ë³€ì¡° ê²€ì¦
- `signature` ë˜ëŠ” `SignData` ë“±ì„ í™œìš©í•´ ì „ì†¡ ë°ì´í„° ìœ„ë³€ì¡° ì—¬ë¶€ í™•ì¸
- ì„œë²„ ì‚¬ì´ë“œì—ì„œ í•„ìˆ˜ ê²€ì¦ ìˆ˜í–‰ ê¶Œì¥

## í†µë³´ íë¦„ ìš”ì•½

1. ê³ ê°ì´ ê²°ì œë¥¼ ì™„ë£Œí•˜ë©´ PGì‚¬(ë‚˜ì´ìŠ¤í˜ì´)ê°€ ê²°ê³¼ë¥¼ Notify URLë¡œ POST
2. ê°€ë§¹ì  ì„œë²„ì—ì„œ ìˆ˜ì‹  ë°ì´í„°ë¥¼ ê²€ì¦
3. ì •ìƒ ì²˜ë¦¬ëœ ê²½ìš°, ìì²´ ìŠ¹ì¸ ë‹¨ê³„(API í˜¸ì¶œ ë“±)ë¥¼ ì§„í–‰
4. ì‹œìŠ¤í…œ ìƒíƒœ ì—…ë°ì´íŠ¸ ë° ê³ ê° ì‘ë‹µ ì²˜ë¦¬

## ê²°ì œí†µë³´ íŒŒë¼ë¯¸í„°

### ê³µí†µ
| íŒŒë¼ë¯¸í„°          | ê¸¸ì´   | ì„¤ëª…   |
|----------------|------|------|
| Amt            | 12B  | ìƒí’ˆê¸ˆì•¡ (ì˜ˆì‹œ: 1000) |
| AuthCode       | 30B  | ìŠ¹ì¸ë²ˆí˜¸ |
| AuthDate       | 12B  | ìŠ¹ì¸ì¼ì‹œ (YYMMDDHHMISS) |
| BuyerAuthNum   | 15B  | êµ¬ë§¤ì ì‹ë³„ë²ˆí˜¸ |
| BuyerEmail     | 60B  | êµ¬ë§¤ì e-mail (ì˜ˆì‹œ: it@nicepay.co.kr) |
| FnCd           | 4B   | ì œíœ´ì‚¬ì½”ë“œ |
| FnName         | 20B  | ì œíœ´ì‚¬ëª… |
| GoodsName      | 40B  | ìƒí’ˆëª… (ì˜ˆì‹œ: ê³°ì¸í˜•) |
| MallUserID     | 20B  | ê³ ê° ID |
| MID            | 10B  | ê°€ë§¹ì ì•„ì´ë”” |
| MOID           | 64B  | ì£¼ë¬¸ë²ˆí˜¸ |
| name           | 30B  | êµ¬ë§¤ìëª… |
| PayMethod      | 10B  | ì§€ë¶ˆìˆ˜ë‹¨ |
| RcptAuthCode   | 30B  | í˜„ê¸ˆì˜ìˆ˜ì¦ ìŠ¹ì¸ë²ˆí˜¸ |
| RcptTID        | 30B  | í˜„ê¸ˆì˜ìˆ˜ì¦ TID |
| RcptType       | 1B   | í˜„ê¸ˆì˜ìˆ˜ì¦ íƒ€ì… (ë¯¸ë°œí–‰: 0 / ì†Œë“ê³µì œ: 1 / ì§€ì¶œì¦ë¹™: 2) |
| ReceitType     | 1B   | í˜„ê¸ˆì˜ìˆ˜ì¦ íƒ€ì…, RcptType íŒŒë¼ë¯¸í„°ì™€ ë™ì¼í•œ ê°’ ì‘ë‹µ |
| ResultCode     | 4B   | ê²°ê³¼ì½”ë“œ |
| ResultMsg      | 100B | ê²°ê³¼ë©”ì„¸ì§€ |
| StateCd        | 1B   | ê±°ë˜ ìƒíƒœ (ìŠ¹ì¸: 0, ì „ì·¨ì†Œ: 1, í›„ì·¨ì†Œ: 2) |
| TID            | 30B  | ê±°ë˜ID |
| CancelDate     | 12B  | ì·¨ì†Œì¼ì‹œ (YYMMDDHHMISS) |
| CancelMOID     | 64B  | ì·¨ì†Œìš”ì²­ ì£¼ë¬¸ë²ˆí˜¸ (ì‹ ìš©ì¹´ë“œ ì·¨ì†Œ í†µë³´ ì‹œì—ë§Œ ì‘ë‹µê°’ ì¡´ì¬, ì´ì™¸ ê²°ì œìˆ˜ë‹¨ì€ ë¹ˆ ê°’ìœ¼ë¡œ ì‘ë‹µ) |
| TransType      | 1B   | ì—ìŠ¤í¬ë¡œ ê²°ì œ ì—¬ë¶€, ê²°ì œìˆ˜ë‹¨ì´ ì‹ ìš©ì¹´ë“œ, ê³„ì¢Œì´ì²´, ê°€ìƒê³„ì¢Œì¸ ê²½ìš°ì—ë§Œ ì‘ë‹µ. (0: ì¼ë°˜ ê²°ì œ, 1: ì—ìŠ¤í¬ë¡œ ê²°ì œ) |
| MallReserved   | 500B | ê°€ë§¹ì  ì—¬ë¶„í•„ë“œ |
| MallReserved1  | 10B  | ì‚¬ì—…ìë²ˆí˜¸ |
| MallReserved2  |      | ë¯¸ì‚¬ìš© í•„ë“œì´ë©° ë¹ˆ ê°’ìœ¼ë¡œ ì‘ë‹µí•¨ |
| MallReserved3  |      | ë¯¸ì‚¬ìš© í•„ë“œì´ë©° ë¹ˆ ê°’ìœ¼ë¡œ ì‘ë‹µí•¨ |
| MallReserved4  |      | ë¯¸ì‚¬ìš© í•„ë“œì´ë©° ë¹ˆ ê°’ìœ¼ë¡œ ì‘ë‹µí•¨ |
| MallReserved5  |      | ë¯¸ì‚¬ìš© í•„ë“œì´ë©° ë¹ˆ ê°’ìœ¼ë¡œ ì‘ë‹µí•¨ |
| MallReserved6  |      | ë¯¸ì‚¬ìš© í•„ë“œì´ë©° ë¹ˆ ê°’ìœ¼ë¡œ ì‘ë‹µí•¨ |
| MallReserved7  |      | ë¯¸ì‚¬ìš© í•„ë“œì´ë©° ë¹ˆ ê°’ìœ¼ë¡œ ì‘ë‹µí•¨ |
| MallReserved8  |      | ë¯¸ì‚¬ìš© í•„ë“œì´ë©° ë¹ˆ ê°’ìœ¼ë¡œ ì‘ë‹µí•¨ |
| MallReserved9  |      | ë¯¸ì‚¬ìš© í•„ë“œì´ë©° ë¹ˆ ê°’ìœ¼ë¡œ ì‘ë‹µí•¨ |
| MallReserved10 |      | ë¯¸ì‚¬ìš© í•„ë“œì´ë©° ë¹ˆ ê°’ìœ¼ë¡œ ì‘ë‹µí•¨ |

### ì¹´ë“œ
| íŒŒë¼ë¯¸í„°        | ê¸¸ì´   | ì„¤ëª… |
|----------------|-------|------|
| CardNo         | 16B   | ì¹´ë“œë²ˆí˜¸ (ì˜ˆì‹œ: 12345678****1234) | 
| CardQuota      | 2B    | í• ë¶€ê°œì›” | 
| SUB_ID         | 20B   | ì„œë¸Œ ì•„ì´ë”” | 
| AcquCd         | 3B    | ì¹´ë“œ ë§¤ì…ì‚¬ ì½”ë“œ | 
| AcquName       | 20B   | ì¹´ë“œ ë§¤ì…ì‚¬ëª… | 
| ClickpayCl     | 2B    | ê°„í¸ê²°ì œêµ¬ë¶„ | 
| TermNo         | 20B   | CATID (ë‹¨ë§ê¸°ë¥¼ ì‚¬ìš©í•˜ëŠ” MIDì— í•œí•˜ì—¬ ì‘ë‹µê°’ ì¡´ì¬) | 
| EdiNo          | 20B   | ì „ë¬¸ê´€ë¦¬í•­ëª© (ë‹¨ë§ê¸°ë¥¼ ì‚¬ìš©í•˜ëŠ” MID ì¤‘ ë‹¨ë§ê¸°(ì˜¨/ì˜¤í”„) ê±°ë˜ì— í•œí•˜ì—¬ ì‘ë‹µê°’ ì¡´ì¬) | 
| CardCl         | 2B    | ì¹´ë“œêµ¬ë¶„ (ì‹ ìš©ì¹´ë“œ: 0, ì²´í¬ì¹´ë“œ: 1) | 
| CardType       | 2B    | ì¹´ë“œí˜•íƒœ (ê°œì¸: 01, ë²•ì¸: 02, í•´ì™¸: 03) |

### ê°€ìƒê³„ì¢Œ
| íŒŒë¼ë¯¸í„°        | ê¸¸ì´   | ì„¤ëª…   |
|----------------|-------|-------|
| VbankInputName | 20B   | ê°€ìƒê³„ì¢Œ ì…ê¸ˆìëª… |
| VbankName      | 20B   | ê°€ìƒê³„ì¢Œ ì€í–‰ëª… |
| VbankNum       | 20B   | ê°€ìƒê³„ì¢Œ ë²ˆí˜¸ |


## ğŸ“‚ êµ¬í˜„ ì˜ˆì œ (Pseudo-code)

### 1. Java/JSP êµ¬í˜„

```jsp
<%@ page  contentType="text/html; charset=euc-kr" %>
<%@ page import = "java.io.*" %>
<%@ page import = "java.util.Calendar" %>
<%

//*********************************************************************************
// êµ¬ë§¤ìê°€ ì…ê¸ˆí•˜ë©´ ê²°ì œë°ì´í„° í†µë³´ë¥¼ ìˆ˜ì‹ í•˜ì—¬ DB ì²˜ë¦¬ í•˜ëŠ” ë¶€ë¶„ ì…ë‹ˆë‹¤.
// ìˆ˜ì‹ ë˜ëŠ” í•„ë“œì— ëŒ€í•œ DB ì‘ì—…ì„ ìˆ˜í–‰í•˜ì‹­ì‹œì˜¤.
// ìˆ˜ì‹ í•„ë“œ ìì„¸í•œ ë‚´ìš©ì€ ë©”ë‰´ì–¼ ì°¸ì¡°
//*********************************************************************************

String PayMethod    = request.getParameter("PayMethod");        //ì§€ë¶ˆìˆ˜ë‹¨
String MID          = request.getParameter("MID");              //ìƒì ID
String MallUserID   = request.getParameter("MallUserID");       //íšŒì›ì‚¬ ID
String Amt          = request.getParameter("Amt");              //ê¸ˆì•¡
String name         = request.getParameter("name");             //êµ¬ë§¤ìëª…
String GoodsName    = request.getParameter("GoodsName");        //ìƒí’ˆëª…
String TID          = request.getParameter("TID");              //ê±°ë˜ë²ˆí˜¸
String MOID         = request.getParameter("MOID");             //ì£¼ë¬¸ë²ˆí˜¸
String AuthDate     = request.getParameter("AuthDate");         //ì…ê¸ˆì¼ì‹œ (yyMMddHHmmss)
String ResultCode   = request.getParameter("ResultCode");       //ê²°ê³¼ì½”ë“œ ('4110' ê²½ìš° ì…ê¸ˆí†µë³´)
String ResultMsg    = request.getParameter("ResultMsg");        //ê²°ê³¼ë©”ì‹œì§€
String VbankNum     = request.getParameter("VbankNum");         //ê°€ìƒê³„ì¢Œë²ˆí˜¸
String FnCd         = request.getParameter("FnCd");             //ê°€ìƒê³„ì¢Œ ì€í–‰ì½”ë“œ
String VbankName    = request.getParameter("VbankName");        //ê°€ìƒê³„ì¢Œ ì€í–‰ëª…
String VbankInputName = request.getParameter("VbankInputName"); //ì…ê¸ˆì ëª…
String CancelDate   = request.getParameter("CancelDate");       //ì·¨ì†Œì¼ì‹œ

//*********************************************************************************
//ê°€ìƒê³„ì¢Œì±„ë²ˆì‹œ í˜„ê¸ˆì˜ìˆ˜ì¦ ìë™ë°œê¸‰ì‹ ì²­ì´ ë˜ì—ˆì„ê²½ìš° ì „ë‹¬ë˜ë©° 
//RcptTID ì— ê°’ì´ ìˆëŠ”ê²½ìš°ë§Œ ë°œê¸‰ì²˜ë¦¬ ë¨
//*********************************************************************************
String RcptTID      = request.getParameter("RcptTID");          //í˜„ê¸ˆì˜ìˆ˜ì¦ ê±°ë˜ë²ˆí˜¸
String RcptType     = request.getParameter("RcptType");         //í˜„ê¸ˆ ì˜ìˆ˜ì¦ êµ¬ë¶„(0:ë¯¸ë°œí–‰, 1:ì†Œë“ê³µì œìš©, 2:ì§€ì¶œì¦ë¹™ìš©)
String RcptAuthCode = request.getParameter("RcptAuthCode");     //í˜„ê¸ˆì˜ìˆ˜ì¦ ìŠ¹ì¸ë²ˆí˜¸


//*********************************************************************************
// ì´ë¶€ë¶„ì— ë¡œê·¸íŒŒì¼ ê²½ë¡œë¥¼ ìˆ˜ì •í•´ì£¼ì„¸ìš”.
// ë¡œê·¸ëŠ” ë¬¸ì œë°œìƒì‹œ ì˜¤ë¥˜ ì¶”ì ì˜ ì¤‘ìš”ë°ì´í„° ì´ë¯€ë¡œ ë°˜ë“œì‹œ ì ìš©í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.
//*********************************************************************************
String file_path = "/usr/local/jboss/jboss-as/server/pay/log/nice_vacct_noti_result.log";

File file = new File(file_path);
file.createNewFile();
FileWriter fw = new FileWriter(file_path, true);

fw.write("************************************************\r\n");
fw.write("PayMethod     : " + PayMethod + "\r\n");
fw.write("MID           : " + MID + "\r\n");
fw.write("MallUserID    : "+ MallUserID + "\r\n");
fw.write("Amt           : " + Amt + "\r\n");
fw.write("name          : " +  name + "\r\n");
fw.write("GoodsName     : " + GoodsName + "\r\n");
fw.write("TID           : "+ TID + "\r\n");
fw.write("MOID          : "+ MOID + "\r\n");
fw.write("AuthDate      : "+ AuthDate + "\r\n");
fw.write("ResultCode    : "+ ResultCode + "\r\n");
fw.write("ResultMsg     : "+ ResultMsg + "\r\n");
fw.write("VbankNum      : "+ VbankNum + "\r\n");
fw.write("FnCd          : "+ FnCd + "\r\n");
fw.write("VbankName     : "+ VbankName + "\r\n");
fw.write("VbankInputName : "+ VbankInputName + "\r\n");
fw.write("RcptTID       : "+ RcptTID + "\r\n");
fw.write("RcptType      : "+ RcptType + "\r\n");
fw.write("RcptAuthCode  : "+ RcptAuthCode + "\r\n");
fw.write("CancelDate    : "+ CancelDate + "\r\n");
fw.write("************************************************\r\n");
  
fw.close();
  
//ê°€ë§¹ì  DBì²˜ë¦¬ 
  
//**************************************************************************************************
//**************************************************************************************************
//ê²°ì œ ë°ì´í„° í†µë³´ ì„¤ì • > â€œOKâ€ ì²´í¬ë°•ìŠ¤ì— ì²´í¬í•œ ê²½ìš°" ë§Œ ì²˜ë¦¬ í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
//**************************************************************************************************		
//TCPì¸ ê²½ìš° OK ë¬¸ìì—´ ë’¤ì— ë¼ì¸í”¼ë“œ ì¶”ê°€
//ìœ„ì—ì„œ ìƒì  ë°ì´í„°ë² ì´ìŠ¤ì— ë“±ë¡ ì„±ê³µìœ ë¬´ì— ë”°ë¼ì„œ ì„±ê³µì‹œì—ëŠ” "OK"ë¥¼ NICEPAYë¡œ
//ë¦¬í„´í•˜ì…”ì•¼í•©ë‹ˆë‹¤. ì•„ë˜ ì¡°ê±´ì— ë°ì´í„°ë² ì´ìŠ¤ ì„±ê³µì‹œ ë°›ëŠ” FLAG ë³€ìˆ˜ë¥¼ ë„£ìœ¼ì„¸ìš”
//(ì£¼ì˜) OKë¥¼ ë¦¬í„´í•˜ì§€ ì•Šìœ¼ì‹œë©´ NICEPAY ì„œë²„ëŠ” "OK"ë¥¼ ìˆ˜ì‹ í• ë•Œê¹Œì§€ ê³„ì† ì¬ì „ì†¡ì„ ì‹œë„í•©ë‹ˆë‹¤
//ê¸°íƒ€ ë‹¤ë¥¸ í˜•íƒœì˜ PRINT(out.print)ëŠ” í•˜ì§€ ì•Šìœ¼ì‹œê¸° ë°”ëë‹ˆë‹¤
//if (ë°ì´í„°ë² ì´ìŠ¤ ë“±ë¡ ì„±ê³µ ìœ ë¬´ ì¡°ê±´ë³€ìˆ˜ = true) 
//  {
//      out.print("OK"); // ì ˆëŒ€ë¡œ ì§€ìš°ì§€ ë§ˆì„¸ìš”
//  } 
//  else 
//  {
//      out.print("FAIL"); // ì ˆëŒ€ë¡œ ì§€ìš°ì§€ ë§ˆì„¸ìš”
//  }
//*************************************************************************************************	
//*************************************************************************************************
 
%>
```

### 2. PHP êµ¬í˜„

```php
<?php

//'**********************************************************************************
//' êµ¬ë§¤ìê°€ ì…ê¸ˆí•˜ë©´ ê²°ì œë°ì´í„° í†µë³´ë¥¼ ìˆ˜ì‹ í•˜ì—¬ DB ì²˜ë¦¬ í•˜ëŠ” ë¶€ë¶„ ì…ë‹ˆë‹¤.
//' ìˆ˜ì‹ ë˜ëŠ” í•„ë“œì— ëŒ€í•œ DB ì‘ì—…ì„ ìˆ˜í–‰í•˜ì‹­ì‹œì˜¤.
//' ìˆ˜ì‹ í•„ë“œ ìì„¸í•œ ë‚´ìš©ì€ ë©”ë‰´ì–¼ ì°¸ì¡°
//'**********************************************************************************

@extract($_GET);
@extract($_POST);
@extract($_SERVER);

$PayMethod      = $PayMethod;           //ì§€ë¶ˆìˆ˜ë‹¨
$M_ID           = $MID;                 //ìƒì ID
$MallUserID     = $MallUserID;          //íšŒì›ì‚¬ ID
$Amt            = $Amt;                 //ê¸ˆì•¡
$name           = $name;                //êµ¬ë§¤ìëª…
$GoodsName      = $GoodsName;           //ìƒí’ˆëª…
$TID            = $TID;                 //ê±°ë˜ë²ˆí˜¸
$MOID           = $MOID;                //ì£¼ë¬¸ë²ˆí˜¸
$AuthDate       = $AuthDate;            //ì…ê¸ˆì¼ì‹œ (yyMMddHHmmss)
$ResultCode     = $ResultCode;          //ê²°ê³¼ì½”ë“œ ('4110' ê²½ìš° ì…ê¸ˆí†µë³´)
$ResultMsg      = $ResultMsg;           //ê²°ê³¼ë©”ì‹œì§€
$VbankNum       = $VbankNum;            //ê°€ìƒê³„ì¢Œë²ˆí˜¸
$FnCd           = $FnCd;                //ê°€ìƒê³„ì¢Œ ì€í–‰ì½”ë“œ
$VbankName      = $VbankName;           //ê°€ìƒê³„ì¢Œ ì€í–‰ëª…
$VbankInputName = $VbankInputName;      //ì…ê¸ˆì ëª…
$CancelDate     = $CancelDate;          //ì·¨ì†Œì¼ì‹œ

//ê°€ìƒê³„ì¢Œì±„ë²ˆì‹œ í˜„ê¸ˆì˜ìˆ˜ì¦ ìë™ë°œê¸‰ì‹ ì²­ì´ ë˜ì—ˆì„ê²½ìš° ì „ë‹¬ë˜ë©° 
//RcptTID ì— ê°’ì´ ìˆëŠ”ê²½ìš°ë§Œ ë°œê¸‰ì²˜ë¦¬ ë¨
$RcptTID        = $RcptTID;             //í˜„ê¸ˆì˜ìˆ˜ì¦ ê±°ë˜ë²ˆí˜¸
$RcptType       = $RcptType;            //í˜„ê¸ˆ ì˜ìˆ˜ì¦ êµ¬ë¶„(0:ë¯¸ë°œí–‰, 1:ì†Œë“ê³µì œìš©, 2:ì§€ì¶œì¦ë¹™ìš©)
$RcptAuthCode   = $RcptAuthCode;        //í˜„ê¸ˆì˜ìˆ˜ì¦ ìŠ¹ì¸ë²ˆí˜¸

//**********************************************************************************
//ì´ë¶€ë¶„ì— ë¡œê·¸íŒŒì¼ ê²½ë¡œë¥¼ ìˆ˜ì •í•´ì£¼ì„¸ìš”.
$logfile = fopen("C:\\NICEPAY20\\log\\nice_vacct_noti_result.log", "a+" );
//ë¡œê·¸ëŠ” ë¬¸ì œë°œìƒì‹œ ì˜¤ë¥˜ ì¶”ì ì˜ ì¤‘ìš”ë°ì´í„° ì´ë¯€ë¡œ ë°˜ë“œì‹œ ì ìš©í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.
//**********************************************************************************
 
fwrite( $logfile,"************************************************\r\n");
fwrite( $logfile,"PayMethod     : ".$PayMethod."\r\n");
fwrite( $logfile,"MID           : ".$MID."\r\n");
fwrite( $logfile,"MallUserID    : ".$MallUserID."\r\n");
fwrite( $logfile,"Amt           : ".$Amt."\r\n");
fwrite( $logfile,"name          : ".$name."\r\n");
fwrite( $logfile,"GoodsName     : ".$GoodsName."\r\n");
fwrite( $logfile,"TID           : ".$TID."\r\n");
fwrite( $logfile,"MOID          : ".$MOID."\r\n");
fwrite( $logfile,"AuthDate      : ".$AuthDate."\r\n");
fwrite( $logfile,"ResultCode    : ".$ResultCode."\r\n");
fwrite( $logfile,"ResultMsg     : ".$ResultMsg."\r\n");
fwrite( $logfile,"VbankNum      : ".$VbankNum."\r\n");
fwrite( $logfile,"FnCd          : ".$FnCd."\r\n");
fwrite( $logfile,"VbankName     : ".$VbankName."\r\n");
fwrite( $logfile,"VbankInputName : ".$VbankInputName."\r\n");
fwrite( $logfile,"RcptTID       : ".$RcptTID."\r\n");
fwrite( $logfile,"RcptType      : ".$RcptType."\r\n");
fwrite( $logfile,"RcptAuthCode  : ".$RcptAuthCode."\r\n");
fwrite( $logfile,"CancelDate    : ".$CancelDate."\r\n");
fwrite( $logfile,"************************************************\r\n");

fclose( $logfile );

//ê°€ë§¹ì  DBì²˜ë¦¬
  
//**************************************************************************************************
//**************************************************************************************************
//ê²°ì œ ë°ì´í„° í†µë³´ ì„¤ì • > â€œOKâ€ ì²´í¬ë°•ìŠ¤ì— ì²´í¬í•œ ê²½ìš°" ë§Œ ì²˜ë¦¬ í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
//**************************************************************************************************
//TCPì¸ ê²½ìš° OK ë¬¸ìì—´ ë’¤ì— ë¼ì¸í”¼ë“œ ì¶”ê°€
//ìœ„ì—ì„œ ìƒì  ë°ì´í„°ë² ì´ìŠ¤ì— ë“±ë¡ ì„±ê³µìœ ë¬´ì— ë”°ë¼ì„œ ì„±ê³µì‹œì—ëŠ” "OK"ë¥¼ NICEPAYë¡œ
//ë¦¬í„´í•˜ì…”ì•¼í•©ë‹ˆë‹¤. ì•„ë˜ ì¡°ê±´ì— ë°ì´í„°ë² ì´ìŠ¤ ì„±ê³µì‹œ ë°›ëŠ” FLAG ë³€ìˆ˜ë¥¼ ë„£ìœ¼ì„¸ìš”
//(ì£¼ì˜) OKë¥¼ ë¦¬í„´í•˜ì§€ ì•Šìœ¼ì‹œë©´ NICEPAY ì„œë²„ëŠ” "OK"ë¥¼ ìˆ˜ì‹ í• ë•Œê¹Œì§€ ê³„ì† ì¬ì „ì†¡ì„ ì‹œë„í•©ë‹ˆë‹¤
//ê¸°íƒ€ ë‹¤ë¥¸ í˜•íƒœì˜ PRINT(out.print)ëŠ” í•˜ì§€ ì•Šìœ¼ì‹œê¸° ë°”ëë‹ˆë‹¤
//if (ë°ì´í„°ë² ì´ìŠ¤ ë“±ë¡ ì„±ê³µ ìœ ë¬´ ì¡°ê±´ë³€ìˆ˜ = true)
//{
//            echo "OK";                        // ì ˆëŒ€ë¡œ ì§€ìš°ì§€ë§ˆì„¸ìš”
//}
//else 
//{
//            echo "FAIL";                        // ì ˆëŒ€ë¡œ ì§€ìš°ì§€ë§ˆì„¸ìš”
//}
//*************************************************************************************************	
//*************************************************************************************************
?>
```

### 3. C# (ASP.NET) êµ¬í˜„

```csharp
using System;
using System.Web.UI;
using System.IO;

public partial class niceVacctNoti : System.Web.UI.Page
{
    protected string LogPath;

    protected void Page_Load(object sender, EventArgs e)
    {
        if (!Page.IsPostBack)
        {
            responseVacctNoti();
        }
    }

    protected void responseVacctNoti()
    {
        String sPayMethod      = Request.Params["PayMethod"];          // ì§€ë¶ˆìˆ˜ë‹¨
        String sMID            = Request.Params["MID"];                // ìƒì ID
        String sMallUserID     = Request.Params["MallUserID"];         // íšŒì›ì‚¬ ID
        String sAmt            = Request.Params["Amt"];                // ê¸ˆì•¡
        String sName           = Request.Params["name"];               // êµ¬ë§¤ìëª…
        String sGoodsName      = Request.Params["GoodsName"];          // ìƒí’ˆëª…
        String sTID            = Request.Params["TID"];                // ê±°ë˜ë²ˆí˜¸
        String sMOID           = Request.Params["MOID"];               // ì£¼ë¬¸ë²ˆí˜¸
        String sAuthDate       = Request.Params["AuthDate"];           // ì…ê¸ˆì¼ì‹œ (yyMMddHHmmss)
        String sResultCode     = Request.Params["ResultCode"];         // ê²°ê³¼ì½”ë“œ ('4110' ê²½ìš° ì…ê¸ˆí†µë³´)
        String sResultMsg      = Request.Params["ResultMsg"];          // ê²°ê³¼ë©”ì‹œì§€
        String sVbankNum       = Request.Params["VbankNum"];           // ê°€ìƒê³„ì¢Œë²ˆí˜¸
        String sFnCd           = Request.Params["FnCd"];               // ê°€ìƒê³„ì¢Œ ì€í–‰ì½”ë“œ
        String sVbankName      = Request.Params["VbankName"];          // ê°€ìƒê³„ì¢Œ ì€í–‰ëª…
        String sVbankInputName = Request.Params["VbankInputName"];     // ì…ê¸ˆì ëª…
        String sCancelDate     = Request.Params["CancelDate"];         // ì·¨ì†Œì¼ì‹œ
 
        // ê°€ìƒê³„ì¢Œì±„ë²ˆì‹œ í˜„ê¸ˆì˜ìˆ˜ì¦ ìë™ë°œê¸‰ì‹ ì²­ì´ ë˜ì—ˆì„ê²½ìš° ì „ë‹¬ (RcptTID, RcptType, RcptAuthCode)
        String sRcptTID        = Request.Params["RcptTID"];            // í˜„ê¸ˆì˜ìˆ˜ì¦ ê±°ë˜ë²ˆí˜¸
        String sRcptType       = Request.Params["RcptType"];           // í˜„ê¸ˆ ì˜ìˆ˜ì¦ êµ¬ë¶„(0:ë¯¸ë°œí–‰, 1:ì†Œë“ê³µì œìš©, 2:ì§€ì¶œì¦ë¹™ìš©)
        String sRcptAuthCode   = Request.Params["RcptAuthCode"];       // í˜„ê¸ˆì˜ìˆ˜ì¦ ìŠ¹ì¸ë²ˆí˜¸

        // ë¡œê·¸íŒŒì¼ 
        FileInfo file = new FileInfo(@"C:\log\nice_vacct_noti_result.log");
        StreamWriter sw = file.AppendText();
        sw.WriteLine("************************************************");
        sw.WriteLine("PayMethod      : " + sPayMethod);
        sw.WriteLine("M_ID           : " + sMID);
        sw.WriteLine("MallUserID     : " + sMallUserID);
        sw.WriteLine("Amt            : " + sAmt);
        sw.WriteLine("name           : " + sName);
        sw.WriteLine("GoodsName      : " + sGoodsName);
        sw.WriteLine("TID            : " + sTID);
        sw.WriteLine("MOID           : " + sMOID);
        sw.WriteLine("AuthDate       : " + sAuthDate);
        sw.WriteLine("ResultCode     : " + sResultCode);
        sw.WriteLine("ResultMsg      : " + sResultMsg);
        sw.WriteLine("VbankNum       : " + sVbankNum);
        sw.WriteLine("FnCd           : " + sFnCd);
        sw.WriteLine("VbankName      : " + sVbankName);
        sw.WriteLine("VbankInputName : " + sVbankInputName);
        sw.WriteLine("RcptTID        : " + sRcptTID);
        sw.WriteLine("RcptType       : " + sRcptType);
        sw.WriteLine("RcptAuthCode   : " + sRcptAuthCode);
        sw.WriteLine("CancelDate     : " + sCancelDate);        
        sw.WriteLine("************************************************");
        sw.WriteLine("");
        sw.Flush();
        sw.Close();

        /****************************************************
         * <ê²°ì œ ê²°ê³¼ ê°€ë§¹ì  ë°ì´í„°ë² ì´ìŠ¤ ì²˜ë¦¬>
         * 
         * ê°€ìƒê³„ì¢Œ ì…ê¸ˆê²°ê³¼ë¥¼ ê°€ë§¹ì  ì…ê¸ˆì™„ë£Œ ì²˜ë¦¬ë¥¼ ìœ„í•´
         * ë°ì´í„°ë² ì´ìŠ¤ ì²˜ë¦¬ë¥¼ í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
         * 
        ****************************************************/

        bool insertSuccess = true; // ê°€ë§¹ì  ë°ì´í„°ë² ì´ìŠ¤ ì²˜ë¦¬ê°€ ì™„ë£Œëœ ê²ƒìœ¼ë¡œ ê°€ì •í•©ë‹ˆë‹¤.

        // ê°€ë§¹ì  DBì²˜ë¦¬ - ê²°ì œ ë°ì´í„° í†µë³´ ì„¤ì • > â€œOKâ€ ì²´í¬ë°•ìŠ¤ì— ì²´í¬í•œ ê²½ìš°" ë§Œ ì²˜ë¦¬ í•˜ì‹œê¸° ë°”ëë‹ˆë‹¤.
        // TCPì¸ ê²½ìš° OK ë¬¸ìì—´ ë’¤ì— ë¼ì¸í”¼ë“œ ì¶”ê°€
        if (insertSuccess == true) {
            Response.Write("OK");
            Response.End();
        } else {
            Response.Write("FAIL");
            Response.End();
        }
    }
}
```

## ğŸ“Œ ì£¼ì˜ì‚¬í•­ ìš”ì•½

- **Notify URL(IP)** ì„¤ì •: ì‚¬ì „ì— ì¸ì¦ëœ URL/IPë§Œ ì ‘ê·¼ í—ˆìš©
- ë°ì´í„° ìœ„ë³€ì¡° ë°©ì§€ ê²€ì¦ í•„ìˆ˜
- ì¤‘ë³µ Notifyì— ëŒ€ë¹„í•œ **idempotency ì²˜ë¦¬** í•„ìš”
- ê²°ì œ ì·¨ì†Œ, ì¸ì¦ ì‹œê°„ ì´ˆê³¼ ë“± ì˜ˆì™¸ ì¼€ì´ìŠ¤ë„ í•„ìˆ˜ ëŒ€ì‘

## ğŸ”— ê²°ì œí†µë³´ ì—°ê´€ ë¬¸ì„œ
- [ì¸ì¦ ê²°ì œ API ê°€ì´ë“œ](https://developers.nicepay.co.kr/manual-auth.php)
- [ê²°ì œ ì¡°íšŒ API](https://developers.nicepay.co.kr/manual-status.php)
- [ê²°ì œ ì·¨ì†Œ API](https://developers.nicepay.co.kr/manual-cancel.php)
